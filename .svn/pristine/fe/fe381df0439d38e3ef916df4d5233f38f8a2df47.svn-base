<?phpnamespace Home\Controller;use User\Api\UserApi;class AddressController extends HomeController{    public function index(){        $this->login();        $this->redirect('address');    }    public function getProvince(){        //三级联动获取城市级别        $suggest = I("post.suggest");        $c = M('Address_city');        $list = $c->where('provincecode = '.$suggest)->select();        $this->ajaxReturn($list);    }    public function getCity(){        //三级联动获取县,区级别        $suggest = I('post.suggest');        $t = M('Address_town');        $list = $t->where('citycode = '.$suggest)->select();        $this->ajaxReturn($list);    }    public function address(){        $m = D('User_address');        $uid = session('user_auth.uid');        if(IS_POST){            if($m->create()){                $m->uid = $uid;                if($insertid=$m->add()){                    $this->ajaxReturn(array("info"=>'地址添加成功','status'=>1,'insertid'=>$insertid,'url'=>U('Address/address')));                }else{                    $this->error('地址添加失败');                }            }else{                $this->error($m->getError());            }        }else{            $p = M('Address_province');            //显示当前用户的送餐地址信息            $arr = $m->where('uid = '.$uid)->order('flag desc,address_id desc')->select();            //显示省级城市            $list = $p->select();            $this->assign('list',$list);            $this->assign('data',$arr);            $this->assign("_controller",CONTROLLER_NAME);            $this->assign("meta_title",'送餐地址管理');            $this->assign('is_login',is_login());            $this->display();        }    }    public function address_del(){        //删除用户送餐地址        $m = M('User_address');        $id = I('post._id');        $where = 'address_id = '.$id;        $list = $m->where($where)->delete();        $this->ajaxReturn($list);    }    public function address_edit(){        $this->meta_title = '编辑送餐地址';        $m = D('User_address');        $id = I('address_id');        if(IS_POST){            if($m->create()){                if($m->where('address_id = '.$id)->save()){                    $this->success('更新成功',U('Address/address'));                }else{                    $this->error('更新失败');                }            }else{                $this->error($m->getError());            }        }else{            $list = $m->find($id);            $this->assign('elist',$list);            $this->assign("_controller",CONTROLLER_NAME);            $this->assign("meta_title",'编辑送餐地址');            $this->display();        }    }    public function setFlag(){        $id = I('post._id');        $m = M('User_address');        //当点击为默认地址时，当前状态更新为1，其他所有地址状态更新为0        $data = $m->where('address_id = '.$id)->setField('flag',1);        $m->where('address_id != '.$id)->setField('flag',0);        $this->ajaxReturn($data);    }}?>