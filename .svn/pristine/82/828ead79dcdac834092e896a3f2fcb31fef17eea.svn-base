<?php if (!defined('THINK_PATH')) exit();?><!doctype html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title><?php echo ($meta_title); ?>｜<?php echo C('WEB_SITE_TITLE');?>后台管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="author" content="<?php echo C('WEB_SITE_TITLE');?>">
    <meta name="keywords" content="<?php echo ($meta_keywords); ?>">
    <meta name="description" content="<?php echo ($meta_description); ?>">
    <meta name="generator" content="CoreThink">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="<?php echo C('WEB_SITE_TITLE');?>">
    <meta name="format-detection" content="telephone=no,email=no">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <link rel="apple-touch-icon" type="image/x-icon" href="/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/Public/libs/cui/css/cui.min.css">
    <link rel="stylesheet" type="text/css" href="/./Application/Admin/View/Public/css/admin.css?v=<?php echo C('STATIC_VERSION');?>">
    <link rel="stylesheet" type="text/css" href="/./Application/Admin/View/Public/css/theme/<?php echo C('ADMIN_THEME');?>.css">
    <link rel="stylesheet" type="text/css" href="/Public/libs/cui/css/page.css">
    <link rel="stylesheet" type="text/css" href="/Public/libs/cui/css/cui.extend.min.css">
        <style>        body{            padding:20px;            font-family: "Microsoft Yahei";        }    </style>
    <!--[if lt IE 9]>
        <script src="http://cdn.bootcss.com/html5shiv/r29/html5.min.js"></script>
        <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- 如果配置里CDN静态资源列表则使用CDN否则使用静态资源 -->
    <?php if(C('CDN_RESOURCE_LIST')): ?>
        <?php echo C('CDN_RESOURCE_LIST');?>
    <?php else: ?>
        <script type="text/javascript" src="/Public/libs/jquery/1.x/jquery.min.js"></script>

    <?php endif; ?>
    <!--<script type="text/javascript" src="/Public/common.js"></script>-->
</head>

<body>
    <div class="clearfix full-header">
        
    </div>

    <div class="clearfix full-container">

            <div class="main-title m-b">    </div><!-------查询按钮--------->    <div class="form-group" style="border-bottom: 1px solid #DDDCDC;border-top: 1px solid #DDDCDC;">        <div class="form-inline"  style="padding: 20px 0px 20px 0px;font-size: 14px;">            <div class="form-group"  style="width: 100%;">                <label  for="exampleInputEmail3">下单时间：</label>                <input type="text" readonly="readonly" class="form-control date" style="width:12.5%;"  id="exampleInputEmail3" name="stime" value="<?php echo ($stime); ?>" placeholder="请选择日期" <?php if(!empty($stime)): ?>value="<?php echo (date('Y-m-d',$stime)); ?>"<?php endif; ?> >                <i class="fa fa-repeat" style="color: #0edd81;cursor: pointer;margin-left: -30px;"></i>&nbsp;&nbsp;                <label  for="exampleInputEmail3" style="margin-left:15px;">至</label>                <input type="text"  readonly="readonly"  class="form-control date" style="width:12.5%;margin-left:15px;" id="exampleInputEmail4" name="etime" value="<?php echo ($etime); ?>" placeholder="请选择日期" <?php if(!empty($etime)): ?>value="<?php echo (date('Y-m-d',$etime)); ?>"<?php endif; ?> >                <i class="fa fa-repeat" style="color: #0edd81;cursor: pointer;margin-left: -30px;"></i>                <label  for="exampleInputEmail3" style="margin-left:30px;">关键字：</label>                <input type="text" class="form-control" id="order_sn" value="<?php echo ($order_sn); ?>" name="order_sn" placeholder="订单编号" style="width:12.5%;">                <button class="btn btn-success btn-cha" type="button" style="margin-left: 30px;">查询</button>            </div>            <br/>            <div class="form-group" style="margin-top:20px;">                <label  for="exampleInputEmail3">订单状态：</label>                <input type="radio" class="radio status" value="" name="status" id="status"  <?php if(($status) == ""): ?>checked="checked"<?php endif; ?>><label style="font-size: 13px;font-weight: 100"  for="status">全部</label>                <input type="radio" class="radio status" value="4" name="status"  id="status1" <?php if(($status) == "4"): ?>checked="checked"<?php endif; ?> style="margin-left: 10px;"><label style="font-size: 13px;font-weight: 100" for="status1">已确认</label>                <input type="radio" class="radio status" value="5" name="status"   id="status2"<?php if(($status) == "5"): ?>checked="checked"<?php endif; ?> style="margin-left: 10px;"><label style="font-size: 13px;font-weight: 100" for="status2">已完成</label>                <input type="radio" class="radio status" value="10" name="status"  id="status3" <?php if(($status) == "10"): ?>checked="checked"<?php endif; ?> style="margin-left: 10px;"><label style="font-size: 13px;font-weight: 100" for="status3">无效</label>            </div>            <br/>            <div class="form-group" style="margin-top:20px;">                <label  for="exampleInputEmail3">支付类型：</label>                <input type="radio" class="radio pay_type" value="" name="pay_type" id="pay_type"  <?php if(($pay_type) == ""): ?>checked="checked"<?php endif; ?>><label style="font-size: 13px;font-weight: 100" for="pay_type">全部</label>                <input type="radio" class="radio pay_type" value="1" style="margin-left: 10px;" name="pay_type"  id="pay_type1" <?php if(($pay_type) == "1"): ?>checked="checked"<?php endif; ?>><label style="font-size: 13px;font-weight: 100" for="pay_type1">在线支付</label>                <input type="radio" class="radio pay_type" value="0" style="margin-left: 10px;" name="pay_type"  id="pay_type2" <?php if(($pay_type) == "0"): ?>checked="checked"<?php endif; ?>><label style="font-size: 13px;font-weight: 100" for="pay_type2">线下支付</label>            </div>            <br/>            <div class="form-group" style="margin-top:20px;">                <label  for="exampleInputEmail3">订单类型：</label>                <input type="radio" class="radio send_time" value="" name="send_time" id="send_time" <?php if(($send_time) == ""): ?>checked="checked"<?php endif; ?>><label style="font-size: 13px;font-weight: 100" for="send_time">全部</label>                <input type="radio" class="radio send_time" value="1" name="send_time" id="send_time1" <?php if(($send_time) == "1"): ?>checked="checked"<?php endif; ?> style="margin-left: 10px;"><label style="font-size: 13px;font-weight: 100" for="send_time1">预约单</label>                <input type="radio" class="radio send_time" value="2" name="send_time"  id="send_time2"<?php if(($send_time) == "2"): ?>checked="checked"<?php endif; ?> style="margin-left: 10px;"><label style="font-size: 13px;font-weight: 100" for="send_time2">即时单</label>            </div>        </div>    </div>    <!-------查询按钮结束--------->    <style type="text/css">        .span{            float: left;            margin-left:40px;        }        table tbody tr td{            text-align: center;        }    </style>    <div style="padding:10px">共有&nbsp;&nbsp;<a class="shuliang" style="color: red;"><?php echo ($count); ?></a>&nbsp;&nbsp;条订单记录   &nbsp;&nbsp;订单金额&nbsp;&nbsp;<a class="sumt" style="color: red;"><?php echo ($sum+$ps_cost-$yh_price+$canju_total); ?></a>&nbsp;&nbsp;元</div>    <div class="order_id">        <div class="like">            <?php if(!empty($list)): if(is_array($list)): $i = 0; $__LIST__ = $list;if( count($__LIST__)==0 ) : echo "" ;else: foreach($__LIST__ as $key=>$data): $mod = ($i % 2 );++$i;?><!-----输出菜品------>                    <div class="cf" style="border: 1px solid #dddddd;margin-bottom: 20px;height: auto;">                        <div style="width: 100%;height:43px;background-color:#f3f3f3;border-bottom: 1px solid #dddddd">                            <span class="span" style="line-height: 43px;color:#666">#<?php echo ($data["order_count"]); ?></span>                            <span class="span" style="line-height: 43px;">订单编号：<?php echo ($data["order_sn"]); ?></span>                            <span class="span" style="line-height: 43px;">下单时间：<?php echo (date('Y-m-d  H:i',$data["xd_time"])); ?></span>                            <span class="span" style="line-height: 43px;">订单金额：￥<?php echo ($data['total']+$data['ps_cost']+$data['canju_total']-$data['yh_price']); ?></span>            <span style="line-height: 43px;float: right;margin-right: 80px;">订单状态：                <?php switch($data["status"]): case "1": ?>未支付订单<?php break;?>                    <?php case "2": ?>已支付订单<?php break;?>                    <?php case "3": ?>货到付款<?php break;?>                    <?php case "4": ?>商家已确认<?php break;?>                    <?php case "5": ?>完成订单<?php break;?>                    <?php case "6": ?>完成评价<?php break;?>                    <?php case "7": ?>取消订单<?php break;?>                    <?php case "8": ?>取消已付款订单<?php break;?>                    <?php case "9": ?>商家拒单 &nbsp;&nbsp;&nbsp;&nbsp;原因：<?php echo ($data["reject_reason"]); break;?>                    <?php case "10": ?>商家拒单 &nbsp;&nbsp;&nbsp;&nbsp;原因：<?php echo ($data["reject_reason"]); break;?>                    <?php case "11": ?>退款中<?php break;?>                    <?php case "12": ?>退款完成<?php break;?>                    <?php case "13": ?>用户下单，商家接单，后用户取消订单<?php break;?>                    <?php case "14": ?>制作完成<?php break;?>                    <?php case "15": ?>退款中<?php break;?>                    <?php case "16": ?>退款中<?php break;?>                    <?php case "17": ?>退款完成<?php break;?>                    <?php case "18": ?>退款完成<?php break;?>                    <?php default: endswitch;?>            </span>                        </div>                        <div style="margin-top: 15px;padding:0px 30px 5px 30px;height: 210px;">                            <button type="submit" class="btn btn-primary daying">打印</button>                                <?php if($data["status"] == 9): ?><button type="submit" class="btn btn-warning" disabled="disabled"  style=" margin-left:25px;">  拒单完成  </button>                                    <?php elseif($data["status"] == 10): ?>                                    <button type="submit" class="btn btn-warning" disabled="disabled"   style=" margin-left:25px;">  拒单完成  </button>                                    <?php elseif($data["status"] == 5): ?>                                    <button type="submit" class="btn btn-warning" disabled="disabled"   style=" margin-left:25px;">  已完成订单  </button>                                    <?php elseif($data["status"] == 7): ?>                                    <button type="submit" class="btn btn-warning" disabled="disabled"   style=" margin-left:25px;">  取消订单  </button>                                    <?php elseif($data["status"] == 8): ?>                                    <button type="submit" class="btn btn-warning" disabled="disabled"   style=" margin-left:25px;">  取消已付款订单  </button>                                    <?php elseif($data["status"] == 11): ?>                                    <button type="submit" class="btn btn-warning" disabled="disabled"   style=" margin-left:25px;">  退款中  </button>                                    <?php elseif($data["status"] == 12): ?>                                    <button type="submit" class="btn btn-warning" disabled="disabled"   style=" margin-left:25px;">  退款完成  </button>                                    <?php elseif($data["status"] == 13): ?>                                    <button type="submit" class="btn btn-warning" disabled="disabled"   style=" margin-left:25px;">  用户取消订单  </button>                                    <?php elseif($data["status"] == 15): ?>                                    <button type="submit" class="btn btn-warning" disabled="disabled"   style=" margin-left:25px;">  退款中  </button>                                    <?php elseif($data["status"] == 16): ?>                                    <button type="submit" class="btn btn-warning" disabled="disabled"   style=" margin-left:25px;">  退款中  </button>                                    <?php elseif($data["status"] == 17): ?>                                    <button type="submit" class="btn btn-warning" disabled="disabled"   style=" margin-left:25px;">  退款完成  </button>                                    <?php elseif($data["status"] == 18): ?>                                    <button type="submit" class="btn btn-warning" disabled="disabled"   style=" margin-left:25px;">  退款完成  </button>                                    <?php else: ?>                                    <button type="submit" class="btn btn-warning" data-id="<?php echo ($data["order_id"]); ?>" data-status="<?php echo ($data["status"]); ?>" data-toggle="modal" data-target="#myModal" style=" margin-left:25px;">  拒单  </button><?php endif; ?>                                <?php if($data["status"] == 5): ?><button type="submit" class="btn btn-success" disabled="disabled" style=" margin-left:25px;">已完成</button>                                    <?php elseif($data["status"] == 9): ?>                                       <button type="submit" class="btn btn-success" disabled="disabled" style=" margin-left:25px;">已拒单</button>                                    <?php elseif($data["status"] == 10): ?>                                       <button type="submit" class="btn btn-success" disabled="disabled" style=" margin-left:25px;">已拒单</button>                                    <?php elseif($data["status"] == 4): ?>                                    <button type="submit" class="btn btn-success wancheng" data-id="<?php echo ($data["order_id"]); ?>" style=" margin-left:25px;">完成</button>                                    <?php elseif($data["status"] == 6): ?>                                    <button type="submit" class="btn btn-success wancheng" data-id="<?php echo ($data["order_id"]); ?>" style=" margin-left:25px;">完成</button>                                    <?php elseif($data["status"] == 14): ?>                                    <button type="submit" class="btn btn-success wancheng" data-id="<?php echo ($data["order_id"]); ?>" style=" margin-left:25px;">完成</button>                                    <?php else: ?>                                    <button type="submit"  disabled="disabled"  class="btn btn-success wancheng" style=" margin-left:25px;">完成</button><?php endif; ?>                                <?php if($data["dispatch_status"] == 1): ?><button type="submit" class="btn btn-default" disabled="disabled" style=" margin-left:25px;"> 已推送  </button>                                    <?php elseif($data["status"] == 9): ?>                                    <button type="submit" class="btn btn-default" disabled="disabled" style=" margin-left:25px;"> 已拒单  </button>                                    <?php elseif($data["status"] == 10): ?>                                    <button type="submit" class="btn btn-default" disabled="disabled" style=" margin-left:25px;"> 已拒单 </button>                                    <?php elseif($data["status"] == 5): ?>                                    <button type="submit" class="btn btn-default" disabled="disabled" style=" margin-left:25px;"> 已完成 </button>                                    <?php else: ?>                                   <button type="submit" class="btn btn-default " data-id="<?php echo ($data["order_id"]); ?>" data-status="<?php echo ($data["dispatch_status"]); ?>" style=" margin-left:25px;"> 推送  </button><?php endif; ?>                            <p style="margin-top:20px;">顾客ID：<?php echo ($data["uid"]); ?>                     <span style="margin-left: 40px;">                        <?php if($data["gender"] == 1): ?>顾客姓名：<?php echo ($data["username"]); ?>先生                            <?php else: ?>                            顾客姓名：<?php echo ($data["username"]); ?>女士<?php endif; ?>                     </span>                                <span style="margin-left: 40px;">顾客电话：<?php echo ($data["phone"]); ?></span>                                <span style="margin-left: 40px;">顾客地址：<?php echo ($data["detail_address"]); ?></span>                            </p>                            <p style="margin-top:20px;">订单备注：<?php echo ($data["order_message"]); ?></p>                            <p style="margin-top:20px;">期望时间：<?php echo (date("Y-m-d H:i",$data["send_time"])); ?></p>                            <p style="margin-top:20px;background-color: #89c900;border-radius: 10px;width:75px;">                <span style="padding:8px;color: #fff">                    <?php if($data["pay_type"] == 1): ?>在线支付                        <?php else: ?>                        货到付款<?php endif; ?>                </span>                            </p>                        </div>                        <div style="margin-top: 15px;padding:0px 30px 5px 30px;height:auto;">                            <div style="width: 50%;height: auto;border: 1px solid #dddddd;float: left;">                                <table style="line-height:30px;width: 100%;height: 30px;">                                    <thead style="background-color: #F1F1F1;border-bottom: 1px solid #dddddd">                                    <th>菜品</th>                                    <th>单价</th>                                    <th>数量</th>                                    <th>金额</th>                                    </thead>                                    <tbody>                                    <?php if(is_array($data['xiang'])): $i = 0; $__LIST__ = $data['xiang'];if( count($__LIST__)==0 ) : echo "" ;else: foreach($__LIST__ as $key=>$vo): $mod = ($i % 2 );++$i;?><tr>                                            <td><?php echo ($vo['cm'][0]['cm_name']); ?></td>                                            <td><?php echo ($vo['price']); ?></td>                                            <td><?php echo ($vo['quantity']); ?></td>                                            <td><?php echo ($vo['total_money']); ?></td>                                        </tr><?php endforeach; endif; else: echo "" ;endif; ?>                                    <tr style="border-top: 1px solid #dddddd;background-color:#F1F1F1; ">                                        <td>小计：</td>                                        <td></td>                                        <td></td>                                        <td ><?php echo ($data["total"]); ?></td>                                    </tr>                                    </tbody>                                </table>                            </div>                            <div style="width: 34%;border: 1px solid #dddddd;height:auto;margin-left: 60%;">                                <table style="line-height:30px;width: 100%;">                                    <thead style="background-color: #F1F1F1;border-bottom: 1px solid #dddddd;">                                    <th>其它费用</th>                                    <th>金额</th>                                    </thead>                                    <tbody>                                    <tr>                                        <td>配送费</td>                                        <td><?php echo ($data["ps_cost"]); ?></td>                                    </tr>                                    <tr>                                        <td>餐盒费</td>                                        <td><?php echo ($data["canju_total"]); ?></td>                                    </tr>                                    <tr>                                        <td>优惠</td>                                        <td><?php echo ($data["yh_price"]); ?></td>                                    </tr>                                    </tbody>                                </table>                            </div>                        </div>                        <div style="clear:both "></div>                        <div style="height: 40px;margin-right:10%;float: none;margin-top:50px;">                            <p style="float: right">&nbsp;&nbsp;总计：<span style="color: red;"><?php echo ($data['total']+$data['ps_cost']+$data['yh_price']+$data['canju_total']); ?>元</span></p>                        </div>                       <!-- <div style="height: 50px;margin-top: 20px;border-top: 1px solid #dddddd;float: none;">                            <p style="line-height: 50px;margin-left: 40px;">第三方配送电话：1546461151656</p>                        </div>-->                    </div>                    <!-----输出菜品结束------>                    <!--顾客小票start-->                    <div class="ticketMain" style="display:none;">                        <div class="ticketMainTitle">                            给顾客专用&nbsp;&nbsp;&nbsp;&nbsp;#：<?php echo ($data["order_count"]); ?>                        </div>                        <div class="Blank10">*****************************</div>                        <div class="Title fw"><div class="pdt5"><?php echo C('TICKETNAME');?></div><div class="pdt5" id="customer_ticket_pay_type">[<?php echo ($data["pay_type"]); ?>]</div></div>                        <div class="Blank10">*****************************</div>                        <div class="pdt5" id="customer_ticket_send_time"> 期望送达时间：<?php echo (date("Y-m-d H:i",$data["send_time"])); ?></div><div class="pdt5" id="customer_ticket_order_message">订单备注：<?php echo ($data["order_message"]); ?></div>                        <div class="Blank10">*****************************</div>                        <div class="pdt5" id="customer_ticket_order_sn"> 订单编号：<?php echo ($data["order_sn"]); ?></div><div class="pdt5" id="customer_ticket_xd_time">下单时间：<?php echo (date("Y-m-d H:i:s",$data["xd_time"])); ?></div>                        <div class="Blank10">*****************************</div>                        <table class="fz18">                            <thead><th align="left">菜单名称</th><th align="center">数量</th><th align="right">金额</th></thead>                            <tbody id="good_detail">                            <?php if(is_array($data["xiang"])): $i = 0; $__LIST__ = $data["xiang"];if( count($__LIST__)==0 ) : echo "" ;else: foreach($__LIST__ as $key=>$vo): $mod = ($i % 2 );++$i;?><tr>                                    <td width="60%" align="left"><?php echo ($vo['cm'][0]['cm_name']); ?></td>                                    <td width="20%" align="center"><?php echo ($vo['quantity']); ?></td>                                    <td width="20%" align="right"><?php echo ($vo['total_money']); ?></td>                                </tr><?php endforeach; endif; else: echo "" ;endif; ?>                            <tr>                                <td width="80%" colspan="2" align="left">餐盒费：</td>                                <td width="20%" align="right"><?php echo ($data["canju_total"]); ?></td>                            </tr>                            <!---->                            <tr>                                <td width="80%" colspan="2" align="left">配送费：</td>                                <td width="20%" align="right"><?php echo ($data["ps_cost"]); ?></td>                            </tr>                            <tr>                                <td width="80%" colspan="2" align="left">优惠：</td>                                <td width="20%" align="right"><?php echo ($data["yh_price"]); ?></td>                            </tr>                            <tr>                                <td width="80%" colspan="2" align="left">总计：</td>                                <td width="20%" align="right"><?php echo ($data['total']+$data['ps_cost']+$data['yh_price']+$data['canju_total']); ?></td>                            </tr>                            </tbody>                        </table>                        <div class="Blank10">*****************************</div>                        <div class="pdt5 fz18 fw" id="customer_ticket_username"> 姓名：                            <?php if($data['user_address']['0']['gender'] == 1): echo ($data['user_address']['0']['username']); ?>&nbsp;&nbsp;&nbsp;先生                                <?php else: ?>                                <?php echo ($data['user_address']['0']['username']); ?>&nbsp;&nbsp;&nbsp;女士<?php endif; ?>                        </div>                        <!---->                        <div class="pdt5 fz18 fw" id="customer_ticket_detail_address"> 地址：<?php echo ($data['user_address']['0']['detail_address']); ?></div>                        <div class="pdt5 fz18 fw" id="customer_ticket_phone"> 电话：<?php echo ($data['user_address']['0']['phone']); ?></div>                        <div class="Blank10">*****************************</div>                        <div class="pdt5" id="customer_ticket_store_name"> <?php echo ($data['store']['store_name']); ?></div>                        <div class="pdt5" id="customer_ticket_tel"> <?php echo ($data['store']['tel']); ?></div>                        <div class="Blank10">*****************************</div>                        <div class="pdt5" id="customer_ticket_now_time"> <?php echo C('TICKETNAME');?> <?php echo (date("Y年m月d日 H:i:s",$time)); ?></div>                    </div>                    <!--顾客小票end--><?php endforeach; endif; else: echo "" ;endif; ?>                <?php else: ?>                <div style="height: 50px;margin-top: 20px;border: 1px solid #dddddd;background-color: #f3f3f3"> <p style="line-height: 50px;text-align: center;">ON 今天暂时还没有订单</p> </div><?php endif; ?>        </div>    </div>    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">        <div class="modal-dialog">            <div class="modal-content">                <div class="modal-header">                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                    <h4 class="modal-title">请输入拒单原因</h4>                </div>                <div class="modal-body">                    <div class="jinggao" style="width: 100%;height: 30px;background-color:#F1F1F1;border: 1px solid #F2F2F2;display: none"><p style="line-height: 30px;color: red;">拒单原因不能为空！！！</p></div>                    <textarea name="reject_reason" cols="73" rows="5" placeholder="请输入拒单详情. . ." style="margin-top: 20px;"></textarea>                </div>                <div class="modal-footer">                    <button type="button" class="btn btn-info" data-dismiss="modal">取消</button>                    <button type="button" class="btn btn-primary confirm">确认</button>                </div>            </div><!-- /.modal-content -->        </div><!-- /.modal-dialog -->    </div><!-- /.modal -->
    </div>

    <div class="clearfix full-footer">
        
    </div>

    <div class="clearfix full-script">
        <div class="container-fluid">
            <input type="hidden" id="corethink_home_img" value="/./Application/Home/View/Public/img">
            <script type="text/javascript" src="/Public/libs/cui/js/cui.min.js"></script>
            <script type="text/javascript" src="/./Application/Admin/View/Public/js/admin.js?v=<?php echo C('STATIC_VERSION');?>"></script>
            <script type="text/javascript" src="/Public/libs/cui/js/cui.extend.min.js"></script>
                <link href="/Public/datetimepicker/css/datetimepicker.css" rel="stylesheet" type="text/css">    <script type="text/javascript" src="/Public/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>    <script type="text/javascript" src="/Public/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>    <script type="text/javascript" src="/Public/LodopFuncs.js"></script>    <script type="text/javascript">        var LODOP=getLodop();        $(document).ready(function(){            $('[data-toggle="popover"]').popover();            $('.date').datetimepicker({                format: 'yyyy-mm-dd',                language:"zh-CN",                minView:2,                autoclose:true            });            $('.btn-cha,input[type="radio"]').on('click',function(){                var stime = $('#exampleInputEmail3').val();                var etime = $('#exampleInputEmail4').val();                var order_sn = $("#order_sn").val();                var status = $("input[name='status']:checked").val();                var pay_type = $("input[name='pay_type']:checked").val();                var send_time = $("input[name='send_time']:checked").val();                var store_id = 1;                var url = "<?php echo U('Order/query');?>";                $.post(url, {                    stime: stime,                    etime: etime,                    order_sn: order_sn,                    status: status,                    pay_type: pay_type,                    send_time: send_time,                    store_id:store_id,                }, function (data) {                    if(data != ""){                        var content = "";                        var sum = 0;                        for(var i=0; i<data.length;i++) {                            sum += Math.abs(data[i]['zongjia']);                            var caiping = "";                            var caiping1 = "";                            for (var n = 0; n < data[i]['xiangqing'].length; n++) {                                caiping += ('<tr><td>' + data[i]['xiangqing'][n]['cm_name']['cm_name'] + '</td><td>' + data[i]['xiangqing'][n]['price'] + '</td><td>' + data[i]['xiangqing'][n]['quantity'] + '</td><td>' + data[i]['xiangqing'][n]['total_money'] + '</td></tr>')                            }                            for (var v = 0; v < data[i]['xiangqing'].length; v++) {                                caiping1 += ('<tr><td width="60%" align="left">' + data[i]['xiangqing'][v]['cm_name']['cm_name'] + '</td><td width="20%" align="center">' + data[i]['xiangqing'][v]['quantity'] + '</td><td width="20%" align="center">' + data[i]['xiangqing'][v]['total_money'] + '</td></tr>')                            }                            if(data[i]['dispatch_status'] == 1){                                var status1 = '<button type="submit" class="btn btn-default " disabled="disabled" style=" margin-left:25px;">已推送</button>';                            }else if(data[i]['status'] == 4){                                var status1 = '<button type="submit" class="btn btn-default " data-id="'+data[i]['order_id']+'" data-status="'+data[i]['dispatch_status']+'" style=" margin-left:25px;">推送</button>';                            }else if(data[i]['status'] == 6){                                var status1 = '<button type="submit" class="btn btn-default " data-id="'+data[i]['order_id']+'" data-status="'+data[i]['dispatch_status']+'" style=" margin-left:25px;">推送</button>';                            }else if(data[i]['status'] == 14){                                var status1 = '<button type="submit" class="btn btn-default " data-id="'+data[i]['order_id']+'" data-status="'+data[i]['dispatch_status']+'" style=" margin-left:25px;">推送</button>';                            }else{                                var status1 = '<button type="submit" class="btn btn-default " disabled="disabled"  style=" margin-left:25px;">推送</button>';                            }                            switch(data[i]['status']){                                case "1":                                    var status2 = "未支付";                                    break;                                case "2":                                    var status2 = "已支付";                                    break;                                case "3":                                    var status2 = "货到付款";                                    break;                                case "4":                                    var status2 = "商家已确认";                                    break;                                case "5":                                    var status2 = "完成订单";                                    break;                                case "6":                                    var status2 = "完成评价";                                    break;                                case "7":                                    var status2 = "取消订单";                                    break;                                case "8":                                    var status2 = "取消已付款订单";                                    break;                                case "9":                                    var status2 = "商家拒单&nbsp;&nbsp;&nbsp;&nbsp;原因："+(data[i]['reject_reason']);                                    break;                                case "10":                                    var status2 = "商家拒单原因&nbsp;&nbsp;&nbsp;&nbsp;原因："+(data[i]['reject_reason']);                                    break;                                case "11":                                    var status2 = "退款中";                                    break;                                case "12":                                    var status2 = "退款完成";                                    break;                                case "13":                                    var status2 = "用户下单，商家接单，后用户取消订单";                                    break;                                case "14":                                    var status2 = "制作完成";                                    break;                                case "15":                                    var status2 = "退款中";                                    break;                                case "16":                                    var status2 = "退款中";                                    break;                                case "17":                                    var status2 = "退款完成";                                    break;                                case "18":                                    var status2 = "退款完成";                                    break;                            }                            if(data[i]['status'] == 4){                                var wan = '<button type="submit" class="btn btn-success wancheng" data-id="'+data[i]['order_id']+'" data-status="'+data[i]['status']+'" style=" margin-left:25px;">完成</button>';                                var judan = '<button type="submit" class="btn btn-warning" data-id="'+data[i]['order_id']+'" data-status="'+data[i]['status']+'"  data-toggle="modal" data-target="#myModal" style=" margin-left:25px;">拒单</button>';                            }else if(data[i]['status'] == 6){                                var wan = '<button type="submit" class="btn btn-success wancheng" data-id="'+data[i]['order_id']+'" data-status="'+data[i]['status']+'" style=" margin-left:25px;">完成</button>';                                var judan = '<button type="submit" class="btn btn-warning" data-id="'+data[i]['order_id']+'" data-status="'+data[i]['status']+'"  data-toggle="modal" data-target="#myModal" style=" margin-left:25px;">拒单</button>';                            }else if(data[i]['status'] == 14){                                var wan = '<button type="submit" class="btn btn-success wancheng" data-id="'+data[i]['order_id']+'" data-status="'+data[i]['status']+'" style=" margin-left:25px;">完成</button>';                                var judan = '<button type="submit" class="btn btn-warning" data-id="'+data[i]['order_id']+'" data-status="'+data[i]['status']+'"  data-toggle="modal" data-target="#myModal" style=" margin-left:25px;">拒单</button>';                            }else if(data[i]['status'] == 10){                                var wan = '<button type="submit" class="btn btn-success wancheng" disabled="disabled" style=" margin-left:25px;">完成</button>';                                var judan =  '<button type="submit" class="btn btn-warning" disabled="disabled"   style=" margin-left:25px;">拒单完成</button>';                            }else if(data[i]['status'] == 9){                                var wan = '<button type="submit" class="btn btn-success wancheng" disabled="disabled" style=" margin-left:25px;">完成</button>';                                var judan =  '<button type="submit" class="btn btn-warning" disabled="disabled"  style=" margin-left:25px;">拒单完成</button>';                            }else{                               var wan = '<button type="submit" class="btn btn-success wancheng" disabled="disabled" style=" margin-left:25px;">完成</button>';                                var judan =  '<button type="submit" class="btn btn-warning" disabled="disabled"  style=" margin-left:25px;">拒单</button>';                            }                            content +=('<div class="cf" style="border: 1px solid #dddddd;margin-bottom: 20px;height: auto;">' +                            '<div style="width: 100%;height:43px;background-color:#f3f3f3;border-bottom: 1px solid #dddddd">' +                            '<span class="span" style="line-height: 43px;color:#666666">#'+data[i]['order_count']+'' +                            '</span><span class="span" style="line-height: 43px;">订单编号：'+data[i]['order_sn']+'' +                            '</span><span class="span" style="line-height: 43px;">下单时间：'+data[i]['xd_time']+'</span>' +                            '<span class="span" style="line-height: 43px;">订单金额：￥'+data[i]['zongjia']+'</span>' +                            '<span style="line-height: 43px;float: right;margin-right: 80px;">订单状态：'+status2+'</span>' +                            '</div>' +                            '<div style="margin-top: 15px;padding:0px 30px 5px 30px;height: 210px;">' +                            '<button type="submit" class="btn btn-primary daying">打印</button>' +                            ''+judan+'' +                            ''+wan+'' +                            ''+status1+'' +                            '<p style="margin-top:20px;">顾客ID：'+data[i]['uid']+' ' +                            '<span style="margin-left: 40px;">顾客姓名：'+data[i]['gender']+'</span>' +                            '<span style="margin-left: 40px;">顾客电话：'+data[i]['phone']+'</span>' +                            '<span style="margin-left: 40px;">顾客地址：'+data[i]['detail_address']+'</span>' +                            '</p>' +                            '<p style="margin-top:20px;">订单备注：'+data[i]['order_message']+'</p>' +                            '<p style="margin-top:20px;">期望时间：'+data[i]['send_time']+'</p>' +                            '<p style="margin-top:20px;background-color: #89c900;border-radius: 10px;width:75px;">' +                            '<span style="padding:8px;color: #fff">'+data[i]['pay_type']+'</span>' +                            '</p>' +                            '</div>' +                            '<div style="margin-top: 15px;padding:0px 30px 5px 30px;height:auto;">' +                            '<div style="width: 50%;height: auto;border: 1px solid #dddddd;float: left;">' +                            '<table style="line-height:30px;width: 100%;height: 30px;">' +                            '<thead style="background-color: #F1F1F1;border-bottom: 1px solid #dddddd"><th>菜品</th><th>单价</th><th>数量</th><th>金额</th></thead>' +                            '<tbody>'+caiping+'<tr style="border-top: 1px solid #dddddd;background-color:#F1F1F1; "><td>小计：</td><td></td><td></td><td>'+data[i]['total']+'</td></tr></tbody>' +                            '</table>' +                            '</div>' +                            '</div>' +                            '<div style="width: 34%;border: 1px solid #dddddd;height:auto;margin-left: 60%;">' +                            '<table style="line-height:30px;width: 100%;">' +                            '<thead style="background-color: #F1F1F1;border-bottom: 1px solid #dddddd;"><th>其它费用</th><th>金额</th></thead>' +                            '<tbody><tr><td>配送费：</td><td>'+data[i]['ps_cost']+'</td></tr><tr><td>餐盒费：</td><td>'+data[i]['canju_total']+'</td></tr><tr><td>优惠：</td><td>'+data[i]['yh_price']+'</td></tr></tbody>' +                            '</table>' +                            '</div><div style="clear:both "></div>' +                            '<div style="height: 40px;margin-right:10%;float: none;margin-top:50px;">' +                            '<p style="float: right">&nbsp;&nbsp;总计：<span style="color: red;">'+data[i]['zongjia']+'元</span></p>' +                            '</div>' +                            /*'<div style="height: 50px;margin-top: 20px;border-top: 1px solid #dddddd;float: none;">' +                            '<p style="line-height: 50px;margin-left: 40px;">第三方配送电话：1546461151656</p>' +                            '</div>' +*/                            '<div class="ticketMain" style="display:none;">' +                            '<div class="ticketMainTitle">给顾客专用&nbsp;&nbsp;&nbsp;&nbsp;#：'+data[i]['order_count']+'</div>' +                            '<div class="Blank10">*****************************</div>' +                            '<div class="Title fw"><div class="pdt5">'+data[i]['ticketname']+'</div><div class="pdt5" id="customer_ticket_pay_type">'+data[i]['pay_type']+'</div></div>' +                            '<div class="Blank10">*****************************</div>' +                            '<div class="pdt5" id="customer_ticket_send_time"> 期望送达时间：'+data[i]['send_time']+'</div>' +                            '<div class="pdt5" id="customer_ticket_order_message">订单备注：'+data[i]['order_message']+'</div>' +                            '<div class="Blank10">*****************************</div>' +                            '<div class="pdt5" id="customer_ticket_order_sn"> 订单编号：'+data[i]['order_sn']+'</div>' +                            '<div class="pdt5" id="customer_ticket_xd_time">下单时间：'+data[i]['xd_time']+'</div>' +                            '<div class="Blank10">*****************************</div>' +                            '<table class="fz18">' +                            '<thead><th align="left">菜单名称</th><th align="center">数量</th><th align="right">金额</th></thead>' +                            '<tbody id="good_detail">'+caiping1+'' +                            '<tr><td width="80%" colspan="2" align="left">餐盒费：</td><td width="20%" align="right">'+data[i]['canju_total']+'</td></tr>' +                            '<tr><td width="80%" colspan="2" align="left">配送费：</td><td width="20%" align="right">'+data[i]['ps_cost']+'</td></tr>' +                            '<tr><td width="80%" colspan="2" align="left">优惠：</td><td width="20%" align="right">'+data[i]['yh_price']+'</td></tr>' +                            '<tr><td width="80%" colspan="2" align="left">总计：</td><td width="20%" align="right">'+data[i]['zongjia']+'</td></tr>' +                            '</tbody>' +                            '</table>' +                            '<div class="Blank10">*****************************</div>' +                            '<div class="pdt5 fz18 fw" id="customer_ticket_username"> 姓名：'+data[i]['gender']+'</div>' +                            '<div class="pdt5 fz18 fw" id="customer_ticket_detail_address"> 地址：'+data[i]['detail_address']+'</div>' +                            '<div class="pdt5 fz18 fw" id="customer_ticket_phone"> 电话：'+data[i]['phone']+'</div>' +                            '<div class="Blank10">*****************************</div>' +                            '<div class="pdt5" id="customer_ticket_store_name"> '+data[i]['store_name']+'</div>' +                            '<div class="pdt5" id="customer_ticket_tel">'+data[i]['tel']+'</div>' +                            '<div class="Blank10">*****************************</div>' +                            '<div class="pdt5" id="customer_ticket_now_time"> '+data[i]['ticketname']+' '+data[i]['now_time']+'</div>' +                            '</div>' +                            '</div>')                        }                        $('.like').html(content);                        $('.shuliang').html(data.length);                        $('.sumt').html(sum);                    }else{                        $('.shuliang,.sumt').html("0");                        $('.like').html('<div style="height: 50px;margin-top: 20px;border: 1px solid #dddddd;background-color: #f3f3f3"> <p style="line-height: 50px;text-align: center;">ON 暂时还没有订单</p> </div>');                    }                });            });            $(document).on('click','.btn-default',function(){                var id = $(this).data('id');                var status = $(this).data('status');                var confir=confirm("是否推送");                if(status == 0){                    if (confir == true) {                        $.post("<?php echo U('Order/pushOrders');?>", {id: id}, function (newdata) {                            if (newdata.value == 0) {                                $.alertMessager(newdata.info);                            } else {                                $.alertMessager(newdata.info, 'success');                            }                            setTimeout(function () {                                window.location.reload();                            }, 1500);                        });                    }                }else{                    $(this).attr("disabled","disabled");                }            });            $(document).on('click','.wancheng',function(){                 var id = $(this).data('id');                 var confir=confirm("是否完成");                if (confir == true) {                    $.post("<?php echo U('complete');?>",{id:id},function(data){                         if(data.status == 1){                             $.alertMessager(data.wancheng,'success');                         }                    });                    setTimeout(function(){                        window.location.reload();                    },1500);                };            });            $(document).on('click','.btn-warning',function(){                    status2 = $(this).data('status');                    $('textarea[name="reject_reason"] ').val("");                    judanid = $(this).data('id');            });            $('.confirm').click(function(){                var reject_reason = $('textarea[name="reject_reason"] ').val();                if(reject_reason != ""){                    var confir=confirm("是否拒单");                    if (confir == true) {                        $('.jinggao').hide();                        $.post('<?php echo U("confirm1");?>', {                            id: judanid,                            reject_reason: reject_reason,                            status: status2                        }, function (data) {                            if (data.status == 1) {                                $.alertMessager(data.judan, 'success');                            } else {                                $.alertMessager(data.judan);                            }                            setTimeout(function () {                                window.location.reload();                            }, 1500);                        })                    }                }else{                    $('.jinggao').show();                }            });            $('.fa-repeat').click(function(){                $(this).prev(".date").val("");            });        });        function printing(html,printsn,num){            var num=num || 1;            var printsn= printsn || 0;            LODOP.PRINT_INIT("");            LODOP.ADD_PRINT_HTM(10,5,"100%","100%",html);            LODOP.SET_PRINTER_INDEX(printsn);            LODOP.SET_PRINT_COPIES(num);            LODOP.PRINT();        }        function print_front(){            var htmls=$('.ticketMain').html();            $.get('<?php echo U("getLocalNum");?>').success(function(data){                printing(htmls,data.printer_sn,data.nums);            });        }        function daying(){            print_front();        }    </script>
        </div>
    </div>
</body>
</html>