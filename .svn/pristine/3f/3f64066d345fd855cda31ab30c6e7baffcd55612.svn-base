<extend name="./Application/Admin/View/Public/layout.html"/><block name="main">    <div class="row">        <div class="col-sm-2" style="margin-top: 20px;margin-left:50px;width: auto;padding: 6px 35px 6px 35px;font-size:16px;">编辑地址范围</div>    </div>	<!-- 标签页导航 -->	<div class="tab-wrap" style="margin-top: 50px;">		<div class="tab-content">			<!-- 表单 -->			<form id="form" action="{:U('edit')}" method="post" class="form-horizontal doc-modal-form">				<!-- 基础 -->					<div class="form-group">					<label class="col-sm-2 control-label" >地址范围名称</label>						<div class="col-sm-3">							<input type="hidden" name="scope_id" value="{$_scope.scope_id}" >							<input type="text" class="form-control" name="scope_name" value="{$_scope.scope_name}" id="scope">						</div>								<label style="padding-top:7px;font-weight:normal;">（地址范围名称）</label>				</div>    		     		 <div class="form-group">						<label class="col-sm-2 control-label">商圈名称</label>						<div class="col-sm-2">							<select name="sq_id" class="form-control" >								<volist name="list" id="vo">								<option value="{$vo.sq_id}" <eq name="_scope.sq_id" value="$vo.sq_id">selected="selected"</eq>>{$vo.sq_name}</option>                             	</volist>							</select>								</div>			</div>				<div class="form-group">					<label class="col-sm-2 control-label">经度</label>					<div class="col-sm-2">						<input type="text" name="lng" value="{$_scope.lng}" class="form-control"/>					</div>				</div>				<div class="form-group">					<label class="col-sm-2 control-label">纬度</label>					<div class="col-sm-2" >						<input type="text" value="{$_scope.lat}" class="form-control"  name="lat"/>					</div>				</div>				    		     		        		 <div class="form-group">           		 <label class="col-sm-2 control-label">排序</label>           			 <div class="col-sm-1">               			 <input type="number" class="form-control" name="sort_order" value="{$_scope.sort_order}">           			 </div>           			 <label style="padding-top:7px;font-weight:normal;">（用于分组显示的顺序）</label>       		 </div>       		        	    <div class="form-group">				<label class="col-sm-2 control-label" style="padding-top:4px;">标记状态</label>					<div class="col-sm-1">						<select name="status" class="form-control">							<if condition="$_scope.status == 0 ">								<option value="0">禁用</option> 								<option value="1">启用</option>								<else /> 								<option value="1">启用</option>								<option value="0">禁用</option>							</if>							</select>					</div>					<label style="padding-top:4px;font-weight:normal;">（0表示未启用，1表示启用）</label>			</div>       		 				<!-- 按钮 -->				<div class="form-group">					<label class="col-sm-2 control-label" >&nbsp;</label>					<div class="col-sm-4">						<button class="btn submit-btn ajax-post btn-info" type="submit" target-form="form-horizontal">确定</button>						<button class="btn btn-return btn-info" onclick="javascript:history.back(-1);return false;">返回</button>					</div>				</div>			</form>		</div>	</div>    <div id="bdmap" class="form-horizontal" style="display:none;position: absolute; top: 249.5px; left: 591.5px; width: 700px; height: 470px; box-shadow: rgba(0, 0, 0, 0.6) 0px 0px 3px; z-index: 99; padding-top: 10px; border-radius: 10px; background: rgb(255, 255, 255);">        <div class="bdmap-header form-group">            <label for="inputEmail3" class="col-sm-3 control-label">地址:</label>            <div class="col-sm-6">                <input type="text" id="keyword" name="address" class="form-control" placeholder="输入餐厅地址">                <div id="result1" name="result1" style="position: fixed;z-index: 999;background:#ffffff;width: 335px">                </div>            </div>            <div class="col-sm-2"><button id="doing" class="btn btn-primary">确定</button></div>            <div class="col-sm-1"><a href="javascript:;" id="closeBdmap"><span class="glyphicon glyphicon-remove"></span></a></div>            <div id="searchResultPanel" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;"></div>        </div>        <div class="bdmap-body"></div>    </div></block><block name="script">    <script src="http://webapi.amap.com/maps?v=1.3&key=e2b70eddc67205c44f1486cd2ed4b9d3"></script>	<script type="text/javascript">        var xcoordinate = {'x':'','y':''};        var windowsArr = [];        var marker = [];        var mapObj;        $("#scope").click(function(){            bdmap=$("<div id=\"bdmapshow\"></div>");            $("div.bdmap-body").append(bdmap);            $("#bdmap").css({                "position":"absolute",                "top":($(window).height()/2)-240,                "left":($(window).width()/2)-360,                "width":700,                "height":470,                "background":"#fff",                "borderRadius":"10",                "box-shadow":"0 0 3px rgba(0,0,0,0.6)",                "z-index":99,                "padding-top":"10px",                "border-radius":"10px"            }).show();            maskshow();            $("#bdmapshow").css("height",400);            searchLocal();        })        $("#closeBdmap").click(function(){            $("#bdmap").hide();            bdmap.remove();            maskhide();        });        $("#doing").click(function(){            var keys=$("#keyword").val();            $("input[name='scope_name']").val(keys);            $("input[name='lng']").val(xcoordinate.x);            $("input[name='lat']").val(xcoordinate.y);            $("#closeBdmap").click();        });        //        function searchLocal(){            mapObj = new AMap.Map('bdmapshow', {                resizeEnable: true,                center: [109.845664, 40.666166],                zoom: 13            });            var marker = new AMap.Marker({                position: mapObj.getCenter(),                draggable: true,                cursor: 'move'            });            //在地图中添加ToolBar插件            mapObj.plugin(["AMap.ToolBar"], function () {                toolBar = new AMap.ToolBar();                mapObj.addControl(toolBar);            });            marker.setMap(mapObj);            // 设置点标记的动画效果，此处为弹跳效果            marker.setAnimation('AMAP_ANIMATION_BOUNCE');            document.getElementById("keyword").onkeyup = keydown;            //为地图注册click事件获取鼠标点击出的经纬度坐标            var clickEventListener = mapObj.on('click', function (e) {                xcoordinate.x = e.lnglat.getLng();                xcoordinate.y = e.lnglat.getLat();                var zuobiao = new AMap.LngLat(xcoordinate.x, xcoordinate.y);                marker.setPosition(zuobiao);                marker.setAnimation('AMAP_ANIMATION_BOUNCE');                var geocoder;                //加载地理编码插件                mapObj.plugin(["AMap.Geocoder"], function () {                    geocoder = new AMap.Geocoder({                        radius: 1000, //以已知坐标为中心点，radius为半径，返回范围内兴趣点和道路信息                        extensions: "all"//返回地址描述以及附近兴趣点和道路信息，默认"base"                    });                    //返回地理编码结果                    AMap.event.addListener(geocoder, "complete", geocoder_CallBack2);                    //逆地理编码                    geocoder.getAddress(zuobiao);                });                function geocoder_CallBack2(data) { //回调函数                    //返回地址描述                    var address = data.regeocode.formattedAddress;                    $("#keyword").val(address);                }            });        }        //显示地图        function maskshow(){            if($("#maskDiv").length<=0){                maskdiv=$("<div id=\"maskDiv\"></div>");                $("body").append(maskdiv);                maskdiv.css({"position":"absolute","top":0,"left":0,"height":$(document).height(),"width":$(document).width(),"backgroundColor":"#000","opacity":"0.6","zIndex":88});            }else{                maskdiv.show();            }        }        //隐藏地图        function maskhide(){            maskdiv.hide();        }        //输入提示        function autoSearch() {            var keywords = document.getElementById("keyword").value;            var auto;            //加载输入提示插件            AMap.service(["AMap.Autocomplete"], function() {                var autoOptions = {                    city: "包头市" //城市，默认全国                };                auto = new AMap.Autocomplete(autoOptions);                //查询成功时返回查询结果                if (keywords.length > 0) {                    auto.search(keywords, function(status, result) {                        autocomplete_CallBack(result);                    });                }                else {                    document.getElementById("result1").style.display = "none";                }            });        }        //输出输入提示结果的回调函数        function autocomplete_CallBack(data) {            var resultStr = "";            var tipArr = data.tips;            if (tipArr && tipArr.length > 0) {                for (var i = 0; i < tipArr.length; i++) {                    resultStr += "<div id='divid" + (i + 1) + "' onmouseover='openMarkerTipById(" + (i + 1)                    + ",this)' onclick='selectResult(" + i + ")' onmouseout='onmouseout_MarkerStyle(" + (i + 1)                    + ",this)' style=\"font-size: 13px;cursor:pointer;padding:5px 5px 5px 5px;\"" + "data=" + tipArr[i].adcode + ">" + tipArr[i].name + "<span style='color:#C1C1C1;'>" + tipArr[i].district + "</span></div>";                }            }            else {                resultStr = " π__π 亲,人家找不到结果!<br />要不试试：<br />1.请确保所有字词拼写正确<br />2.尝试不同的关键字<br />3.尝试更宽泛的关键字";            }            document.getElementById("result1").curSelect = -1;            document.getElementById("result1").tipArr = tipArr;            document.getElementById("result1").innerHTML = resultStr;            document.getElementById("result1").style.display = "block";        }        //输入提示框鼠标滑过时的样式        function openMarkerTipById(pointid, thiss) {  //根据id打开搜索结果点tip            thiss.style.background = '#CAE1FF';        }        //输入提示框鼠标移出时的样式        function onmouseout_MarkerStyle(pointid, thiss) {  //鼠标移开后点样式恢复            thiss.style.background = "";        }        //从输入提示框中选择关键字并查询        function selectResult(index) {            if (index < 0) {                return;            }            if (navigator.userAgent.indexOf("MSIE") > 0) {                document.getElementById("keyword").onpropertychange = null;                document.getElementById("keyword").onfocus = focus_callback;            }            //截取输入提示的关键字部分            var text = document.getElementById("divid" + (index + 1)).innerHTML.replace(/<[^>].*?>.*<\/[^>].*?>/g, "");            var cityCode = document.getElementById("divid" + (index + 1)).getAttribute('data');            document.getElementById("keyword").value = text;            key_2 = text;            mapObj.plugin(["AMap.Geocoder"], function() {     //加载地理编码插件                MGeocoder = new AMap.Geocoder();                //返回地理编码结果                AMap.event.addListener(MGeocoder, "complete", geocoder_CallBack);                MGeocoder.getLocation(key_2);  //地理编码            });            document.getElementById("result1").style.display = "none";            //根据选择的输入提示关键字查询            mapObj.plugin(["AMap.PlaceSearch"], function() {                var msearch = new AMap.PlaceSearch();  //构造地点查询类                AMap.event.addListener(msearch, "complete", placeSearch_CallBack); //查询成功时的回调函数                msearch.setCity(cityCode);                msearch.search(text);  //关键字查询查询            });        }        //地理编码返回结果展示        function geocoder_CallBack(data){            //地理编码结果数组            var geocode = new Array();            geocode = data.geocodes;            if(geocode.length>0){                xcoordinate.x =  geocode[0].location.getLng();                xcoordinate.y =  geocode[0].location.getLat();            }        }        //定位选择输入提示关键字        function focus_callback() {            if (navigator.userAgent.indexOf("MSIE") > 0) {                document.getElementById("keyword").onpropertychange = autoSearch;            }        }        //输出关键字查询结果的回调函数        function placeSearch_CallBack(data) {            //清空地图上的InfoWindow和Marker            windowsArr = [];            marker = [];            mapObj.clearMap();            var resultStr1 = "";            var poiArr = data.poiList.pois;            var resultCount = poiArr.length;            for (var i = 0; i < resultCount; i++) {                resultStr1 += "<div id='divid" + (i + 1) + "' onmouseover='openMarkerTipById1(" + i + ",this)' onmouseout='onmouseout_MarkerStyle(" + (i + 1) + ",this)' style=\"font-size: 12px;cursor:pointer;padding:0px 0 4px 2px; border-bottom:1px solid #C1FFC1;\"><table><tr><td><img src=\"http://webapi.amap.com/images/" + (i + 1) + ".png\"></td>" + "<td><h3><font color=\"#00a6ac\">名称: " + poiArr[i].name + "</font></h3>";                resultStr1 += createContent(poiArr[i].type, poiArr[i].address, poiArr[i].tel) + "</td></tr></table></div>";                addmarker(i, poiArr[i]);            }            mapObj.setFitView();        }        //鼠标滑过查询结果改变背景样式，根据id打开信息窗体        function openMarkerTipById1(pointid, thiss) {            thiss.style.background = '#CAE1FF';            windowsArr[pointid].open(mapObj, marker[pointid]);        }        //添加查询结果的marker&infowindow        function addmarker(i, d) {            var lngX = d.location.getLng();            var latY = d.location.getLat();            var markerOption = {                map: mapObj,                icon:"http://webapi.amap.com/theme/v1.3/markers/n/mark_b"+(i+1)+".png",                position: [lngX, latY]            };            var mar = new AMap.Marker(markerOption);            marker.push([lngX, latY]);            var infoWindow = new AMap.InfoWindow({                content: "<h3><font color=\"#00a6ac\">  " + (i + 1) + ". " + d.name + "</font></h3>" + createContent(d.type, d.address, d.tel),                size: new AMap.Size(300, 0),                autoMove: true,                offset: new AMap.Pixel(0, -30)            });            windowsArr.push(infoWindow);            var aa = function(e) {                infoWindow.open(mapObj, mar.getPosition());            };            mar.on( "mouseover", aa);        }        //infowindow显示内容        function parseStr(p){            if(!p || p == "undefined" || p == " undefined"||p=="tel"){                p="暂无";            }            return p;        }        function createContent(type, address, tel) {  //窗体内容            type=parseStr(type);            address=parseStr(address);            tel=parseStr(tel);            var s=[];            s.push("地址：" +address);            s.push("电话：" +tel);            s.push("类型：" +type);            return s.join("<br>");        }        function keydown(event) {            var key = (event || window.event).keyCode;            var result = document.getElementById("result1");            var cur = result.curSelect;            if(key == 40){                if (cur + 1 < result.childNodes.length) {                    if (result.childNodes[cur]) {                        result.childNodes[cur].style.background = '';                    }                    result.curSelect = cur + 1;                    result.childNodes[cur + 1].style.background = '#CAE1FF';                    document.getElementById("keyword").value = result.tipArr[cur + 1].name;                }            }else if(key == 38){                if (cur - 1 >= 0) {                    if (result.childNodes[cur]) {                        result.childNodes[cur].style.background = '';                    }                    result.curSelect = cur - 1;                    result.childNodes[cur - 1].style.background = '#CAE1FF';                    document.getElementById("keyword").value = result.tipArr[cur - 1].name;                }            }else if(key == 13){                var res = document.getElementById("result1");                if (res && res['curSelect'] !== -1) {                    selectResult(document.getElementById("result1").curSelect);                }            }else{                autoSearch();            }        }		highlight_subnav('{:U('index')}');	</script>    </block>