<?php/** * 地址范围数据库 * 数据库表名 wm_RestaurantScope * scope_id      餐厅地址范围Id * scope_name    地址范围名称 * lng           经度 * lat           纬度 * sq_id         所属商圈id * sort_order    排序 * status        状态(1启用，0未启用) */namespace Administration\Controller;use Admin\Controller\AdminController;class RestaurantScopeController extends AdminController{	//初始化    public function index(){		$User = M('RestaurantScope'); // 实例化User对象		$count      = $User->count();// 查询满足要求的总记录数		$Page       = new \Think\Page($count,15);// 实例化分页类 传入总记录数和每页显示的记录数(25)		$Page->setConfig('header','<span class="rows">共 %TOTAL_ROW% 条记录</span>');        $Page->setConfig('first','首页');        $Page->setConfig('prev','上一页');        $Page->setConfig('next','下一页');        $Page->setConfig('last','末页');        $Page->setConfig('theme','%HEADER% %FIRST% %UP_PAGE% %LINK_PAGE% %DOWN_PAGE% %END% ');        $Page->lastSuffix = false;//分页最后的总页数不显示		$show       = $Page->show();// 分页显示输出		// 进行分页数据查询 注意limit方法的参数要使用Page类的属性		$list = $User->alias('s')->join('LEFT JOIN wm_shangquan AS c ON s.sq_id=c.sq_id')->field('s.*,c.sq_name')->order('sort_order')->limit($Page->firstRow.','.$Page->listRows)->select();		$this->assign('list',$list);// 赋值数据集		$this->assign('page',$show);// 赋值分页输出		$this->meta_title = '地址范围管理';  		$this->display(); // 输出模板		    }		//标记	public function toogleHide($id,$value = 1){        $this->editRow('RestaurantScope', array('status'=>$value), array('scope_id'=>$id));    }		//增加地址范围	public function add(){		if(IS_POST){			$rules = array(			array('scope_name','require','地址范围名称不能为空！'),			array('scope_name','','地址范围名称已经存在！',0,'unique',1),			array('lng','require','地图坐标不能为空！'),			);			$User = M("RestaurantScope");  //动态验证			if ($User->validate($rules)->create()){				$shop = D('RestaurantScope');            	$data = $shop->create();				if($data){                    if($User->add()){						$this->success('新增成功',U('index'));				   	}				   	else{						$this->error('新增失败');				    }				}else{				 	$this->error($shop->getError());				}			}else{				$this->error($User->getError());			}		}else{						//商圈			$city = M('Shangquan'); 			$arr_city = $city->select();			$this->meta_title = '增加地址范围';			$this->assign('_shangquan',$arr_city);        	$this->display(); 		}								 	}		//删除地址范围	public function del(){		$id = array_unique((array)I('scope_id',0));        $map = array('scope_id' => array('in', $id) );        if(M('RestaurantScope')->where($map)->delete()){            $this->success('删除成功');        }else{            $this->error('删除失败！');        }	}		//编辑地址范围	public function edit(){		$this->meta_title = '编辑地址范围'; 		if(IS_POST){			$rules1 = array(			array('scope_name','require','地址范围名称不能为空！'),			array('scope_name','','地址范围名称已经存在！',0,'unique',1),			array('lng','require','地图坐标不能为空！'),			);			$verify = M("RestaurantScope");  //动态验证			if ($verify->validate($rules1)->create()){				$Menu = D('RestaurantScope');            	$data = $Menu->create();            	if($data){               		if($Menu->save()!== false){           			                    	$this->success('更新成功','admin.php?s=/RestaurantScope/add.html');                	}            	}else{ 		                	$this->error($Menu->getError());            	}        	}else{            	$this->error($verify->getError());				        	}				}else{			$id = I('get.scope_id');            $city = M('RestaurantScope')->field(true)->find($id);/* 获取数据 */             if(false === $city){                $this->error('获取后台地址范围错误');            }									$city1 = M('Shangquan');   			$arr_city = $city1->select(); 			$this->assign('list',$arr_city);			            $this->assign('_scope', $city);            $this->display();			}            	}}