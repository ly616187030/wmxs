<extend name="./Application/Admin/View/Public/layout.html"/><block name="main">    <div class="row">        <div class="col-sm-2" style="margin-top: 20px;margin-left:50px;width: auto;padding: 6px 35px 6px 35px;font-size:16px;">编辑配送范围</div>    </div>	<!-- 标签页导航 -->	<div class="tab-wrap" style="margin-top: 50px;">		<div class="tab-content">			<!-- 表单 -->			<form id="form" action="{:U('edit')}" method="post" class="form-horizontal doc-modal-form">				<!-- 基础 -->					<div class="form-group">					<label class="col-sm-2 control-label" >配送范围坐标</label>						<div class="col-sm-3">							<input type="hidden" name="store_id" value="{$data.store_id}" >							<textarea type="text" rows="5" readonly="true"  class="form-control" name="distribution_range"  id="store_range" data-zb_x="{$data.lng}"data-zb_y="{$data.lat}" data-zbj="{$data.distribution_range}">{$data.distribution_range}</textarea>						</div>                    <label style="padding-top:7px;font-weight:normal;color:red">（点击文本域设置配送范围坐标）</label>				</div>				<!-- 按钮 -->				<div class="form-group">					<label class="col-sm-2 control-label" >&nbsp;</label>					<div class="col-sm-4">						<button class="btn submit-btn ajax-post btn-info" type="submit" target-form="form-horizontal">确定</button>						<button class="btn btn-info" onclick="javascript:history.back(-1);return false;">返回</button>					</div>				</div>			</form>		</div>	</div>    <!--百度地图-->    <div id="bdmap1" class="form-horizontal"  style="display:none;">        <div class="bdmap-header form-group">            <label class="col-sm-7 control-label"></label>            <if condition="($data.distribution_range eq null)">                <div class="col-sm-2"><button  class="btn btn-primary" id="id_cxhz">重新绘制</button></div>                <else />                <div class="col-sm-2"></div>            </if>            <div class="col-sm-2"><button id="id_doing" class="btn btn-primary">确定绘制</button></div>            <div class="col-sm-1"><a href="javascript:;" id="closeBdmap"><span class="glyphicon glyphicon-remove"></span></a></div>            <div id="searchResultPanel" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;"></div>        </div>        <div class="bdmap-body" >            <!--<div id="bdmapshow"></div>-->        </div>    </div></block><block name="script">    <script src="http://webapi.amap.com/maps?v=1.3&key=e2b70eddc67205c44f1486cd2ed4b9d3"></script>	<script type="text/javascript">        var pointsCount; //坐标对象        var mouseTool; //鼠标绘制对象        var marker = [];        var editorTool; //图形编辑对象        var mapObj;  //地图对象        var arr = new Array(); //构建多边形经纬度坐标数组        //点击文本框事件        $("#store_range").click(function(){            bdmap=$("<div id=\"bdmapshow\"></div>");            $("div.bdmap-body").append(bdmap);            $("#bdmap1").css({                "position":"absolute",                "top":($(window).height()/2)-240,                "left":($(window).width()/2)-360,                "width":700,                "height":470,                "background":"#fff",                "borderRadius":"10",                "box-shadow":"0 0 3px rgba(0,0,0,0.6)",                "z-index":99,                "padding-top":"10px",                "border-radius":"10px"            }).show();            maskshow();            $("#bdmapshow").css("height",400);            searchLocal();        })        $("#closeBdmap").click(function(){            $("#bdmap1").hide();            bdmap.remove();            maskhide();        });        //确认事件        $("#id_doing").click(function(){            var zbj = $('#store_range').data('zbj');            if(zbj == null || zbj == ''){                $('#store_range').val(pointsCount.toString());            }else{                $('#store_range').val(arr.join(","));                editorTool.close();            }            $("#closeBdmap").click();        });        //地图初始化        function searchLocal(){            var x = $('#store_range').data("zb_x");            var y = $('#store_range').data("zb_y");            mapObj = new AMap.Map('bdmapshow', {                resizeEnable: true,                center: [x, y],                zoom: 13            });            //在地图中添加ToolBar插件            mapObj.plugin(["AMap.ToolBar"], function () {                toolBar = new AMap.ToolBar();                mapObj.addControl(toolBar);            });            var marker = new AMap.Marker({                position: mapObj.getCenter()            });            marker.setMap(mapObj);            set_graph();        }        // 绘制多边形        function set_graph(){            var zuobiao = $('#store_range').val();            if(zuobiao.length > 4){                arr = [];                strs=zuobiao.split(","); //字符分割                for (i=0;i<strs.length ;i+=2 )                {                    arr.push([strs[i],strs[i+1]]);                }                var polygon = new AMap.Polygon({                    map: mapObj,                    path: arr,                    strokeColor: "#0000ff",                    strokeOpacity: 1,                    strokeWeight: 3,                    fillColor: "#f5deb3",                    fillOpacity: 0.35                });                //添加编辑控件                mapObj.plugin(["AMap.PolyEditor"], function() {                    editorTool = new AMap.PolyEditor(mapObj, polygon);                });                editorTool.open();            }else{                //设置多边形的属性                var polygonOption = {                };                //在地图中添加MouseTool插件                mapObj.plugin(["AMap.MouseTool"], function() {                    var  mouseTool = new AMap.MouseTool(mapObj);                    //使用鼠标工具绘制多边形                    mouseTool.polygon(polygonOption);                    AMap.event.addListener(mouseTool, "draw", function(e) {                        //obj属性就是绘制完成的覆盖物对象                        var drawObj = e.obj;                        //获取坐标集                        pointsCount = e.obj.getPath();                    });                    //重新绘制                    $("#id_cxhz").click(function(){                        mouseTool.close(true);                        mouseTool.polygon();                    });                });            }        }        //显示地图        function maskshow(){            if($("#maskDiv").length<=0){                maskdiv=$("<div id=\"maskDiv\"></div>");                $("body").append(maskdiv);                maskdiv.css({"position":"absolute","top":0,"left":0,"height":$(document).height(),"width":$(document).width(),"backgroundColor":"#000","opacity":"0.6","zIndex":88});            }else{                maskdiv.show();            }        }        //隐藏地图        function maskhide(){            maskdiv.hide();        }		highlight_subnav("{:U('index')}");	</script>    </block>