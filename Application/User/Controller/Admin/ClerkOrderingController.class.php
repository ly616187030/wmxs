<?php/** * 餐品分类数据库 * 数据库表名 wm_canpin * sq_list */namespace User\Controller\Admin;use Admin\Controller\AdminController;use Business\Controller\MenuPctController;class ClerkOrderingController extends AdminController{	//初始化    public function index(){    	$user = M("AdminUser");		$list=$user->alias('m')->join('LEFT JOIN wm_restaurant_allot AS r ON r.uid=m.id')->where("m.user_type=1")->field('m.id AS muid,m.nickname,r.*')->order("m.id DESC")->page($_GET['p'].',15')->select();		$count      = $user->where('user_type=1')->count();		$Page       = new \Think\Page($count,15);		$Page->setConfig('header','<span class="rows">共 %TOTAL_ROW% 条记录</span>');		$Page->setConfig('first','首页');		$Page->setConfig('prev','上一页');		$Page->setConfig('next','下一页');		$Page->setConfig('last','末页');		$Page->setConfig('theme','%HEADER% %FIRST% %UP_PAGE% %LINK_PAGE% %DOWN_PAGE% %END% ');		$Page->lastSuffix = false;//分页最后的总页数不显示		$show       = $Page->show();		$this->assign('page',$show);		foreach($list as $v){			$ids=unserialize($v['store_id']);		}		$this->assign("list",$list);		$this->meta_title = '餐厅授权';		$this->display(); // 输出模板    }		public function setShangQuan(){		$sq_list = $_REQUEST['sq_list'];		$sq_name = $_REQUEST['sq_name'];		$sq_uid = $_REQUEST['uid'];		$user = M("receive_member");				$ret = $user->query("select * from wm_receive_member where uid=".$sq_uid);		if($ret == null){			$data['uid'] = $sq_uid;			$data['sq_list'] = $sq_list;			$data['sq_name'] = $sq_name;			$user->add($data);		}else{			$data['sq_list'] = $sq_list;			$data['sq_name'] = $sq_name;			$user->where("uid=".$sq_uid)->save($data);		}		$this->ajaxReturn($ret); 	}	public function add(){		if(IS_POST){			$id=I('store_id');			$uid=I("uid",0,'intval');			$data['uid']=$uid;			$rst=M('RestaurantAllot');			$sid="";			$sname="";			if(!empty($id)){				foreach($id as $v){					$_v=explode(",",$v);					$sid.=$_v[0].",";					$sname.=$_v[1].",";				}				$data['store_id']=$data1['store_id']=rtrim($sid,",");				$data['store_name']=$data1['store_name']=rtrim($sname,",");			}else{				$this->error('请选择餐厅');			}			!empty($uid) && $res=$rst->where("uid=".$uid)->find();			if(empty($res)){				if($rst->add($data)){					$this->success('操作成功',U('index'));				}else{					$this->error('操作失败');				}			}else{				$sa=$rst->where("uid=".$uid)->save($data1);				if($sa!==false){					$this->success('操作成功',U('index'));				}else{					$this->error('操作失败');				}			}		}else{			$this->assign("uid",I('uid'));			$menus=new MenuPctController();			$province=$menus->getProvince(false);			$this->assign('_province',$province);			$this->display();		}	}	public function getShangquan(){		$code=I('code');		if(!empty($code)){			$res=M("Store")->where("city_code=".$code)->field("store_id,store_name")->select();			$this->ajaxReturn($res);		}	}}