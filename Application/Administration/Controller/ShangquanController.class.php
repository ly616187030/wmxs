<?phpnamespace Administration\Controller;use Admin\Controller\AdminController;class ShangquanController extends AdminController{    public function index(){        //查询商圈信息        $this->meta_title = '商圈管理';        $m = M('Shangquan');        $count = $m->count();        $Page = new \Think\Page($count,10);        //设置分页显示方式        $Page->setConfig('header','<span class="rows">共 %TOTAL_ROW% 条记录</span>');        $Page->setConfig('first','首页');        $Page->setConfig('prev','上一页');        $Page->setConfig('next','下一页');        $Page->setConfig('last','末页');        $Page->setConfig('theme','%HEADER% %FIRST% %UP_PAGE% %LINK_PAGE% %DOWN_PAGE% %END% ');        $Page->lastSuffix = false;//分页最后的总页数不显示        $show = $Page->show();        //查询商圈信息并且按照sort字段排序并且分页        $arr = $m->order('sort asc ,sq_id desc')->limit($Page->firstRow.','.$Page->listRows)->select();        $this->assign('data',$arr);        $this->assign('page',$show);        $this->display();    }    public function add(){        $this->meta_title = '新增商圈';        if(IS_POST){            //新增商圈自动创建数据且在ShangquanModel中自动验证            $m = D('Shangquan');            if($m->create()){                if($m->add()){                    $this->success('新增成功',U('Shangquan/index'));                }else{                    $this->error('新增失败');                }            }else{                $this->error($m->getError());            }        }else{            //实例化添加商圈模版//            $province=A('MenuPct')->getProvince(false);            $this->assign('_province',$province);            $this->display();        }    }    public function del(){        //删除单条商圈信息        $sq_id = I('get.sq_id');        $m = M('Shangquan');        $where['sq_id'] = $sq_id;        $arr = $m->where($where)->delete();        if($arr>0){            $this->success('删除成功');        }else{            $this->error('删除失败');        }    }    public function setFlag(){        //更改单条商圈信息的启用状态，1为已启用，0为未启用        $User = M('Shangquan');        $flag = I('get.flag');        $sq_id = I('get.sq_id');        $where['sq_id'] = $sq_id;        if($flag!=0){            $list = $User->where($where)->setField('flag',0);            if($list>0){                $this->success('禁用成功');            }else{                $this->error('禁用失败');            }        }else{            $list = $User->where($where)->setField('flag',1);            if($list>0){                $this->success('启用成功');            }else{                $this->error('启用失败');            }        }    }    public function edit(){        $this->meta_title = '编辑商圈';        if(IS_POST){            //更新修改以后的商圈信息            $sq_id = I('post.sq_id');            $m = D('Shangquan');            $where ='sq_id = '.$sq_id;            if($m->create()){                $list = $m->where($where)->save();                if($list==true){                    $this->success("更新数据成功",U('Shangquan/index'));                }else{                    $this->error("更新数据失败");                }            }else{                $this->error($m->getError());            }        }else{            //获取要修改的商圈的信息            $m = M('Shangquan');            $id = I('get.sq_id');            $arr = $m->find($id);            $province=A('MenuPct')->getProvince(false);            $this->assign('_province',$province);            $this->assign('data',$arr);            $this->display();        }    }    public function setStatus(){        /*         * 通过获取前台flag的值来判断实现的功能         * 1.flag = 1，批量启用商圈         * 2.flag = 0，批量禁用商圈         * 3.flag = -1，批量删除商圈         */        $id = I('sq_id');        $flag = I('get.flag');        $m = M('Shangquan');        $where = 'sq_id in ('.implode(',',$id).')';        if($flag == 1){            $arr = $m->where($where)->setField('flag',1);            if($arr>0){                $this->success("启用成功");            }else{                $this->error("启用失败");            }        }elseif($flag == 0){            $arr = $m->where($where)->setField('flag',0);            if($arr>0){                $this->success("禁用成功");            }else{                $this->error("禁用失败");            }        }elseif($flag == -1){            $list = $m->where($where)->delete();            if($list>0){                $this->success("删除成功");            }else{                $this->error("删除失败");            }        }    }    public function getCity(){        $provinceCode=I('get.provinceCode');        $map['provinceCode']=$provinceCode;        $data=M('address_city')->where($map)->select();        $this->ajaxReturn($data);    }    public function getTown(){        $towncode=I('get.cityCode');        $map['cityCode']=$towncode;        $data=M('address_town')->where($map)->select();        $this->ajaxReturn($data);    }}?>