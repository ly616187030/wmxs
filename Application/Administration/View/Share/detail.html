<extend name="./Application/Admin/View/Public/layout.html"/><block name="style">    <style type="text/css">        body{            padding:40px 20px;            width: 100%;            overflow-x: hidden;        }    </style></block><block name="main">    <div class="row">        <div class="col-sm-2" style="margin-left:50px;width: auto;padding: 6px 35px 6px 35px;font-size:16px;">邀请详情</div>    </div>    <!-- 时间工具栏 -->    <form action="{:U('detail')}" method="post" class="form-horizontal" enctype="multipart/form-data">        <div class="row" style="margin:30px 0px 30px 60px;">            <label class="col-sm-2">请选择时间：</label>            <div class="col-sm-2" style="margin-left: -8%;">                <input readonly="readonly" type="text" id="time-start" name="time" class="form-control" value="{$time}"/>            </div>            <div class="row">                <button class="btn btn-success" id="submit" type="submit" target-form="form-horizontal">查 询</button>                <a href="{:U('detail')}" class="btn btn-success">全 部</a>                <a href="javascript:;" id="allassign" class="btn btn-success">批量派发红包</a>            </div>        </div>    </form>    <!-- 数据列表 -->    <div class="data-table" style="height:29.8em;overflow-y: scroll;">        <table class="table table-bordered text-center table-responsive table-striped table-hover">            <!-- 表头 -->            <thead >            <tr>                <th class="row-selected row-selected">                    <input class="check-all" type="checkbox">                </th>                <th>详情ID</th>                <th>被邀请人</th>                <th>推荐人</th>                <th>奖励类型</th>                <th>奖励额度</th>                <th>获取方式</th>                <th>获得时间</th>                <th>兑现状态</th>                <th>操作</th>            </tr>            </thead>            <!-- 列表 -->            <tbody class="tbody">            <notempty name="list">                <volist name="list" id="vo">                    <tr>                        <td><input class="ids" type="checkbox" data-id="{$vo.share_detail_id}" value="{$vo.tj_openid}" name="id[]"></td>                        <td>{$vo.tj_id}</td>                        <td>                            <if condition="$vo.uid eq 0">                                {$vo.openid}                                <else/>                            {$vo.uid|user_phone}                            </if>                        </td>                        <td>{$vo.tj_id|user_phone}</td>                        <td>                            <switch name="vo.award">                                <case value="1">获得红包</case>                                <case value="2">获得现金红包</case>                                <default />未分配                            </switch>                        </td>                        <td><!--{$vo.award_price}-->{$vo[0]}</td>                        <td>                            <switch name="vo.award_status">                                <case value="0">关注公众号获取</case>                                <case value="1">注册找火锅会员获取</case>                                <default />未分配                            </switch>                        </td>                        <td>{$vo.award_time|date="Y-m-d h:i:s",###}</td>                        <td>                            <switch name="vo.grant_status">                                <case value="0">未兑现</case>                                <case value="1">已兑现</case>                                <default />未分配                            </switch>                        </td>                        <td><if condition="$vo.grant_status eq 0"><a class="assign" data-id="{$vo.share_detail_id}" data-total_fee="{$vo[0]}"  data-tjid="{$vo.tj_id}" data-openid="{$vo.tj_openid}" href="javascript:;" rel="{:U('assign')}">派发红包</a><else/>无</if> </td>                </tr>                </volist>                <else/>                <td colspan="8" class="text-center"> aOh! 暂时没有邀请信息</td>            </notempty>            </tbody>        </table>    </div>    <div class="page">        {$page}    </div></block><block name="script">    <link href="__PUBLIC__/datetimepicker/css/datetimepicker.css" rel="stylesheet" type="text/css">    <php>if(C('COLOR_STYLE')=='blue_color') echo '<link href="__PUBLIC__/datetimepicker/css/datetimepicker_blue.css" rel="stylesheet" type="text/css">';</php>    <link href="__PUBLIC__/datetimepicker/css/dropdown.css" rel="stylesheet" type="text/css">    <script type="text/javascript" src="__PUBLIC__/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>    <script type="text/javascript" src="__PUBLIC__/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>    <script type="text/javascript">        $(function(){            $('#time-start').datetimepicker({                format: 'yyyy-mm-dd',                language:"zh-CN",                minView:2,                autoclose:true            });        })        $('.assign').click(function(){            var $this=$(this);            var openid=$this.data('openid');            var total=$this.data('total_fee');            var id=$this.data('id');            var tj_id = $this.data('tj_id');            if(confirm('派发红包金额为'+total)){                $.get('http://'+document.domain+'/WxPay/pay/redpack.php','openid='+openid+'&total='+total).success(function(data1){                    var data=$.parseJSON(data1);                    if(data.result_code=='FAIL'){                        alert('红包派发失败，错误代码：'+data.err_code+';错误描述：'+data.err_code_des);                    }else if(data.result_code='SUCCESS'){                        alert('红包派发成功');                        $.get('{:U("setconfig")}','grant_status=0&share_detail_id='+id+'&tuijian_id='+tj_id+'&openid='+openid).success(function(){});                        location.reload();                    }                });            }        });        $('#allassign').click(function(){            var all=[],ids=[];            $('input[type="checkbox"]:checked').each(function(){                var $this=$(this);                all.push($this.val());                ids.push($this.data('id'));            });            var i=0;            var ln=all.length;            if(ln!=0){                if(confirm('派发红包金额为'+ln)) {                    (function(){                        if(i>=ln){alert('红包派发完成！');location.reload();}                        //alert(i);                        sendRedPack(ids[i],all[i]);                        i++;                        window.setTimeout(arguments.callee,3000);                    })();                }            }else{                alert('请选择操作的项');            }        });        function sendRedPack(id,openid){            $.get('http://'+document.domain+'/WxPay/pay/redpack.php','openid='+openid+'&total=1').success(function(data1){                var data=$.parseJSON(data1);                //console.log((data.result_code));                if(data.result_code=='FAIL'){                    //alert('红包派发失败，错误代码：'+data.err_code+';错误描述：'+data.err_code_des);                    return;                }else if(data.result_code='SUCCESS'){                    //alert('红包派发成功');                    $.get('{:U("setconfig")}','grant_status=0&share_detail_id='+id).success(function(){});                    //location.reload();                }            });        }        $(function() {            //全选/反选/单选的实现            $(".check-all").click(function() {                $(".ids").prop("checked", this.checked);            });            $(".ids").click(function() {                var option = $(".ids");                option.each(function() {                    if (!this.checked) {                        $(".check-all").prop("checked", false);                        return false;                    } else {                        $(".check-all").prop("checked", true);                    }                });            });            //搜索功能            $('body').on('click', '#search', function() {                var url = $(this).attr('url');                var query = $('.search-form').find('input').serialize();                query = query.replace(/(&|^)(\w*?\d*?\-*?_*?)*?=?((?=&)|(?=$))/g, '');                query = query.replace(/(^&)|(\+)/g, '');                if (url.indexOf('?') > 0) {                    url += '&' + query;                } else {                    url += '?' + query;                }                window.location.href = url;            });            //回车搜索            $(".search-input").keyup(function(e) {                if (e.keyCode === 13) {                    $("#search").click();                    return false;                }            });        });    </script></block>