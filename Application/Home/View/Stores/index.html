<extend name="Base/common_zhgIndex"/><block name="header_zhgIndex"></block><block name="body_zhgIndex">    <div class="main top-line">        <div class="current"><a href="{:U('Waimai/index')}">外卖</a> > <a href="javascript:;">{$storelist.store_name}</a></div>        <div class="storesinfo">            <div class="stores-left" >                <div class="storeslogo pic" id="storeslogo">                    <img src="{$storelist.store_logo_id|get_cover=###,'path'}"                         onerror="javascript:this.src='__HOME_IMAGES__/zhg_common_pic.jpg';"                         style="width:113px;height:83px;" alt="{$storelist.store_name}">                </div>                <div class="OrderInfo">                    <div class="Order-name">{$storelist.store_name}<div class="huodong huodong-right"></div>                    </div>                    <div class="evaluate">                        <div class="praise huo">人气<i></i><i></i><i></i><i></i></div>                        <div class="evaluate-info"><a href="#" target="_blank">查看评论(0)</a></div>                    </div>                    <div class="price">人均消费：<b>{$storelist['qisong_price']/2}</b></div>                    <div class="stores-time">配送时间：{$peisong_time}</div>                </div>                <div class="storesinfo-model" id="storesinfo-model" style="top: 130px;width: 409px;">                    <p>{$storelist.store_name}</p>                    <hr>                    <p>地址:{$storelist.address_detail}</p>                    <div class="leave-message"></div>                </div>            </div>            <div class="stores-right">                <div>在家吃火锅,火锅送到家</div>                <div class="right-line"> <b class="red timeDiv">{$storelist.sh_time}</b>min<br>                    <span class="timeDes">分钟内送达</span>                </div>                <div class="right-line">                    <b class="red">{$storelist.qisong_price} 元</b><br>                    <span>起送价</span>                </div>                <div class="return"><a href="{:U('Waimai/index')}"></a></div>            </div>            <div class="claerfix"></div>        </div>        <div class="step2"></div>        <form action="{:U('index')}" method="post">            <div class="search-wrap reset-search">                <div class="searchInput">                    <a href="{:U('Stores/index','',false)}/store_id/{$id}" class="allLink" style="margin-right: -4px;height: 43px;">全部</a>                    <input id="inputSearchContent" type="text" placeholder="请输入菜品名称" class="search_input" name="cm" value="" style="height: 43px;">                    <input name="store_id" type="hidden" value="{$id}">                    <input type="submit" value="搜索" class="search_sub">                </div>            </div>        </form>        <div class="menuclass">            <div class="fixDivLeft">                <ul>                    <volist name="cp_cate" id="vo" key="k">                        <li class="Facia" typename="{$vo.canpin_name}"  ><a id="cpcate{$vo.canpin_id}" <eq name="k" value="1">style="color:red;border:1px solid red;"</eq> href="#anchor{$vo.canpin_id}" class="dangqian">{$vo.canpin_name}</a></li></li>                    </volist>                </ul>            </div>        </div>        <div class="menus menusDish">            <!--<div class="dayhot dishesID" id="Facia">                <h1>推荐菜</h1>                <volist name="list_hot" id="vo">                <div class="hotbox" style="width: 215px;">                    <div class="Dishes-logo">                        <img title="{$vo.cm_name}" src="{$vo.big_img|get_cover=###,'path'}"                             onerror="{$vo.cm_id|get_cover=###,'path'}';" width="207" height="155" alt="{$vo.cm_name}">                    </div>                    <div class="hot-name" style="height: 25px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;">{$vo.cm_name}</div>                    <div class="price"></div>                    <div class="PriceInfo" style="line-height: 25px;">                        现价：￥<em class="priceEm">{$vo.now_price}</em>/锅                            <a href="javascript:;" style="visibility:visible;margin-top: -5px;"  class="add-cart addCart a1"                               data-price="{$vo.original_price}" unit="份" title="{$vo.cm_name}"                                     data-id="{$vo.cm_id}"></a>                                &lt;!&ndash;--菜品列表移动上去状态--&ndash;&gt;                    </div>                </div>                            <input type="hidden" value="{$vo.store_id}" id="stoer_idd">                </volist>            </div>-->            <volist name="cp_cate" id="vo" key="k">                <div class="dishesGroup dishesID <eq name="vo.must" value='1'>imust</eq><eq name="vo.must" value='2'>imust</eq>" data-name="{$vo.canpin_name}" data-cpid="{$vo.canpin_id}" data-must="{$vo.must}"  <eq name="k" value="1">style="margin-top:0;"</eq> >                <h1  id="anchor{$vo.canpin_id}" ><b>{$vo.canpin_name}</b><span style="color: red"><eq name="vo.must" value="1">(必选)</eq><eq name="vo.must" value="2">(多选一)</eq></span></h1>                <volist name="vo.child" id="ro">                    <div class="DishesItem rela" style="height:auto;margin-top:0px; ">                        <div class="dishes-wrap">                            <div class="Item-name">                                <span class="cm_name" title="{$ro.cm_name}">{$ro.cm_name} <i id="pic" cm_id="{$ro.cm_id}" key="{$key}"></i></span>                            </div>                        </div>                        <span class="red">￥<em class="priceEm">{$ro.now_price}</em>/份</span>                        <a href="javascript:;" class="add-cart addCart a1" data-price="{$ro.now_price}" data-cpname="{$vo.canpin_name}" data-id="{$ro.cm_id}" data-canpinid="{$ro.canping_id}" unit="{$ro.danwei}"  title="{$ro.cm_name}"></a>                        <div class="item-model" id="{$ro.cm_id}">                            <img src="{$ro.big_img|get_cover=###,'path'}" onerror="javascript:this.src='__HOME_IMAGES__/nophoto.png'" width="220" alt="{$ro.cm_name}">                            <p>{$ro.cm_name}</p>                            <p>￥<em class="priceEm">{$ro.now_price}</em>/份</p>                            <div class="intro"><font title='{$vo.canpin_name}' color='#717071'>{$vo.canpin_name}</font></div>                            <div class="btnAddCart addCart reset-btnAddCart">                                <a href="javascript:;" class="add-cart addCart a1" data-cpname="{$vo.canpin_name}" data-price="{$ro.now_price}" data-canpinid="{$ro.canping_id}" unit="{$ro.danwei}" title="{$ro.cm_name}"                                   data-id="{$ro.cm_id}" style="position: absolute;left:50%;margin-left: -28px;">                                </a>                                <div style="height: 20px;width: 100%"></div>                            </div>                        </div>                    </div>                </volist>        </div>        </volist>    </div>    <!--购物车-->    <div class="menuCart">        <div class="fixDivRight">            <div class="cartcontent">                <div class="cart"><span class="remove">清空</span><i></i><b>菜篮子</b></div>                <div class="catr-wrap " style="margin-bottom: 35px;">                </div>                <div class="Allamount">总共：0份</div>                <div class="CartSubmit">                    <a id="lblSubmit" href="javascript:void(0)">下单</a>                    <span class="CartPrice">总价：￥<b class="lbAllPrice">0</b>元</span>                </div>                <div class="tips-drop" style="display: none;"></div>            </div>            <div class="cart-bottom"></div>            <div class="tips">                <p>PS.火锅小常识：您知道吗？平均每人能吃4道菜。</p>            </div>        </div>    </div>    <script>        $(window).scroll(function(){            var wheight = $(this).scrollTop();            var menuheight = $('.menuclass').offset().top;            if(wheight>=menuheight){                $('.fixDivLeft').css({'position':'fixed','top':'0'});                $('.fixDivRight').css({'position':'fixed','top':'0'});            }else{                $('.fixDivLeft').css('position','static');                $('.fixDivRight').css('position','static');            }        });    </script>    </div>    <!----菜品列表移动上去状态---->    <script type="text/javascript">        $(function(){            $('.DishesItem').mouseenter(function(){                $(this).addClass("DishesItem-active").find(".add-cart").css("visibility", "visible");            })            $('.DishesItem'). mouseleave(function(){                $(this).removeClass("DishesItem-active").find(".add-cart").css("visibility", "hidden");            })            var num = $('.cm_name').children('i').length;            for(var i=0; i<num; i++) {                $('.Item-name span i:eq(' + i + ')').click(function () {                    $('.item-model').hide();                    //var id = $(this).attr('cm_id');                    $(this).parent('.cm_name').parent('.Item-name').parent('.dishes-wrap').next('.red').next('.a1').next('.item-model').show();                    $('.item-model').mouseleave(function(){                        $('.item-model').hide();                    })                })            }        });    </script>    <!-------餐具弹窗----------->    <div id="qjBox" class="tool-box" style="display: none; height:auto;position:fixed;top: 50%;left:50%;margin-left:-237px;margin-top: -141.5px;">        <div class="tool-header">            <a href="javascript:;" class="tool-close" ></a>            <h1><img src="__HOME_IMAGES__/q-inc.png" alt="">是否需要器具？</h1>        </div>        <div class="tool-bar">            <div class="tool-list" id="assit857ea133-9770-4cad-b598-4235d7846791">                <span class="tool-name">器具套装（3天内回收）</span>                <span class="tool-wrap"><a href="javascript:;" class="q-btn-minus">                    <img src="__HOME_IMAGES__/cut.png"></a><b class="q-amount" assistID="857ea133-9770-4cad-b598-4235d7846791" id="quantity">1</b>                    <a onclick="numAdd();"class="add"><img src="__HOME_IMAGES__/add.png"></a>                </span>                <span class="q-price">押金: <b id="yj">{$canju.tab_deposit}</b></span>            </div>            <div class="tool-detail">                <p style="display:inline;">含:{$canju.tab_remarks}<br/>3天之内回收。<br/><span style = "color:red;font-size:15px;font-weight:bold;"></span></p><a class="more-detail"style="display:inline;margin-top: -16px;" id="xq">详情</a>                <p class="more-info">{$canju.tab_details}</p>            </div>        </div>        <div class="tool-footer"  id="qd"><a>确定</a></div>    </div>    <div  class="tool-box" style="display: none; height:auto;position: fixed; top: 50%; left: 50%;margin-left:-100px;margin-top:-50px; width: 200px;" id="tsxx">        <div class="tool-bar">            <div class="tool-detail">                <p style="display:inline;"><span style = "color:#9f9f9f;font-size:15px;font-weight:bold;margin-left:20%;font-weight: 300" id="span"></span></p>            </div>        </div>        <div class="tool-footer" id="tishi"><a href="#"  style="width: 70px;height: 30px;line-height: 30px;border: 1px solid #9f9f9f;box-shadow:0 3px 0 #9f9f9f;font-size: 16px;color:#9f9f9f">确定</a></div>    </div>    <script type="text/javascript">        $("#qk").click(function(){            $("#span").html("");        })        $(".r_btn").click(function(){            $("#span").html("");        })        $("#tishi").click(function(){            ztools.maskhide();            $("#tsxx").hide();        });        $(".tool-close").click(function () {            ztools.maskhide();            $("#qjBox").hide();        })        function numAdd(){            var num_add = parseInt($("#quantity").text())+1;            if($("#quantity").text()==""){                num_add = 1;            }            $("#quantity").text(num_add);            $(".tool-footer a").html("确定");        }        $(".q-btn-minus").click(function () {            var amount = parseInt($(this).siblings(".q-amount").html());            if (amount <= 1) {                $(this).siblings(".q-amount").css("visibility", "hidden");                $(this).siblings(".q-btn-add").addClass("add").removeClass("q-btn-add");                $(this).css("visibility", "hidden");            }            $(this).siblings(".q-amount").html(amount - 1);            setNeedQDish();        });        $('.add').click(function(){            $(this).siblings(".q-amount").css("visibility", "visible");            $(this).siblings(".q-btn-minus").css("visibility", "visible");        })        function setNeedQDish() {            var total = 0;            $(".q-amount").each(function () {                var num = $(this).html();                if (num != "") {                    total += parseInt(num);                }            });            if (total == 0) {                $(".tool-footer a").html("不需要");            }        }        $('#xq').click(function(){            if($(".more-info").is(":hidden")) {                $(this).text('收起');            }else{                $(this).text('详情');            }            $(".more-info").toggle("fast");        })        $(".stores-left").mousemove(function(){            $("#storesinfo-model").css("background-color","#ffffff").show();        });        $(".stores-left").mouseout(function(){            $("#storesinfo-model").hide();        });        $(".dangqian").click(function(){            $(".dangqian").css("border","none").css('color','#000')            var $this = this;            $($this).css("border","1px solid red").css('color','red');        })    </script>    <!-------餐具弹窗结束-----------></block><block name="script">    <script type="text/javascript" src="__STATIC__/jquery-1.10.2.min.js"></script>    <script type="text/javascript" src="__STATIC__/ztools.js"></script>    <script type="text/javascript" src="__JS__/jquery.fly.min.js"></script>    <script type="text/javascript">        //购物车        var storeid="{$storelist.store_id}";        var storename="{$storelist.store_name}";        var qisong="{$storelist.qisong_price}";        var cart_info=$("div.Allamount");        var bill=$(".lbAllPrice");        var basket6=$("#basket_view_6");        var basket7=$("#basket_view_7");        var cart_btn=$("#lblSubmit");        var cartview="{:U('Cart/cartView')}";        var islogin='{$is_login}';        //购物车初始化        $.get(cartview,'type=1').success(function(data){            //console.log(data);            if(data==''){                $("div.catr-wrap").text('是空的哟').addClass('cart-default');                set_money();            }else{                var temp=data;                var goodsnum=0;                for(item in temp[0]){                    var id=temp[0][item];                    create_cart(id,data[1][id],data[2][id],data[3][id],data[5][id],data[6][id]);                    goodsnum++;                }                if(goodsnum!=0){                    $("#tcart_total").text(goodsnum).show();                }                set_money();            }        });        $(".addCart").click(function(e){            var e=e;            var $this=$(this);            var url="{:U('Cart/addCart')}";            var idd=$this.data("id");            $.post(url,{                "id":idd,                "name":$this.attr("title"),                "price":$this.data("price"),                "count":1,                "storeid":storeid,                'category_id':$this.data('canpinid'),                'category_name':$this.data('cpname')            }).success(function(data){                //console.log(data);                //basket_notice(data.storename,$this.attr("title"),$this);                shop_fly(e);                if(data.status==1){                    clear_cart();                    $this.click();                }else{                    $.get(cartview,'type=1').success(function(data){                        //console.log(data);                        create_cart(data[0][idd],data[1][idd],data[2][idd],data[3][idd],data[5][idd],data[6][idd]);                        set_money();                    });                }            });        });        //新增商品到购物车        function create_cart(id,title,price,number,categoryid,categoryname){            var canpin=$("#canpin_"+categoryid);            var canming=$('#canming_'+id);            $('.CartList').length==0 && $("div.catr-wrap").empty().removeClass('cart-default');            if(canpin.length==0 && canming.length==0){                var cart_list = $("<div class='CartList' id=\"canpin_"+categoryid+"\"><div class=\"CartGroupTitle\" >"+categoryname+"(<span class='dishcount'>"+number+"</span>)</div><div class='CartItems' id='canming_"+id+"'>" +                        "<span class='ItemName '>"+title+"</span>" +                        "<span class='wrap-input'>" +                        "<a href='javascript:void(0)' class='btn-minus' data-id='"+id+"' style='visibility: hidden;'>-</a>" +                        "<b class='amount'>"+number+"</b>" +                        "<a href='javascript:void(0)' class='btn-add' data-id='"+id+"' style='visibility: hidden;'>+</a>" +                        "</span>" +                        "<span class='c-price'>￥<em class='priceEm'>"+price+"</em></span>" +                        "<span class='item-close' style='visibility: hidden;'>" +                        "<a href='javascript:void(0)' data-id='"+id+"' style='visibility: hidden;'>x</a>" +                        "</span>" +                        "</div></div>");                $("div.catr-wrap").append(cart_list);            }else if(canpin.length>0 && canming.length==0){                var cmlist=$("<div class='CartItems' id='canming_"+id+"'>" +                        "<span class='ItemName '>"+title+"</span>" +                        "<span class='wrap-input'>" +                        "<a href='javascript:void(0)' class='btn-minus' data-id='"+id+"' style='visibility: hidden;'>-</a>" +                        "<b class='amount'>"+number+"</b>" +                        "<a href='javascript:void(0)' class='btn-add' data-id='"+id+"' style='visibility: hidden;'>+</a>" +                        "</span>" +                        "<span class='c-price'>￥<em class='priceEm'>"+price+"</em></span>" +                        "<span class='item-close' style='visibility: hidden;'>" +                        "<a href='javascript:void(0)' data-id='"+id+"' style='visibility: hidden;'>x</a>" +                        "</span>" +                        "</div>");                var ori=canpin.find('.dishcount').text();                canpin.find('.dishcount').text(parseInt(number)+parseInt(ori));                canpin.closest('.CartList').append(cmlist);            }else if(canpin.length>0 && canming.length>0){                canming.find('.amount').text(number);                if($('.CartItems').length>1){                    var ori=canpin.find('.dishcount').text();                    canpin.find('.dishcount').text(1+parseInt(ori));                }else{                    canpin.find('.dishcount').text(number);                }            }        }        //绑定鼠标滑动事件        $('div.catr-wrap').on('mouseenter','.CartItems',function(){            var $this=$(this);            $this.find('.btn-minus').css('visibility','visible');            $this.find('.btn-add').css('visibility','visible');            $this.find('.item-close a').css('visibility','visible');        }).on('mouseleave','.CartItems',function(){            $(this).find('.btn-minus').css('visibility','hidden');            $(this).find('.btn-add').css('visibility','hidden');            $(this).find('.item-close a').css('visibility','hidden');        });        //设置订餐数量和金额        function set_money(){            var url="{:U('Cart/countPrice')}";            $.get(url).success(function(data){                //console.log(data);                if(data=='') {                    cart_info.html('总共：0份&nbsp;');                    bill.text(0);                    is_qisong(qisong,0);                    $("div.catr-wrap").text('是空的哟').addClass('cart-default');                }else{                    cart_info.html('总共：'+data[1]+"份&nbsp;");                    bill.text(data[0]);                    is_qisong(qisong,data[0]);                }            });        }        //判断是否达到起送价        function is_qisong(qisong,current){            var res=(parseInt(qisong)-parseInt(current));            if(res>0){                $('.tips-drop').text('没有到达最低起送价¥'+qisong);                cart_btn.addClass('nosubmit');            }else if(res<=0){                cart_btn.removeClass('nosubmit');            }        }        //判断必点        function is_must(){            var temp=[],must=[],meat=[];            $('.imust').each(function(){                var $this=$(this);                temp.push($this.data('cpid'));                must.push($this.data('must'));                meat.push($this.data('name'));            });            var flag=true;            var flag1=false;            var str='';            if(must[0]==2){                for(var j= 0,ln=temp.length;j<ln;j++){                    if($('#canpin_'+temp[j]).length>0){                        flag1=true;                        return flag1;                    }                }                for(var k= 0,lk=temp.length;k<lk;k++){                    str+=meat[k]+',';                }            }            for(var i= 0,l=temp.length;i<l;i++){                if($('#canpin_'+temp[i]).length<=0 && !flag1){                    //var tips=$('#anchor'+temp[i]).find('b').text();                    var tips=str==''?meat[i]:str;                    $('.tips-drop').text(tips+'必须选择1样');                    //alert($('#cpcate'+temp[i]).get(0));                    flag=false;                    return flag;                }else{                    flag=true;                    //if(must[i]==2) return flag;                }            }            return flag;        }        //增加，删除订餐数量        $(".catr-wrap").on("click","a",function() {            var $this = $(this);            var id=$this.data('id');            if($this.hasClass("btn-minus")){                var cnum=$this.closest('.CartList').find('.dishcount').text();                $this.closest('.CartList').find('.dishcount').text(parseInt(cnum)-1);                set_number(id,1,1,$this);            }else if($this.hasClass("btn-add")){                var cnum=$this.closest('.CartList').find('.dishcount').text();                $this.closest('.CartList').find('.dishcount').text(parseInt(cnum)+1);                set_number(id,1,0,$this);            }else if($this.parent().hasClass("item-close")){                var cpnum=$this.closest('.CartList').find('.dishcount').text();                var v=$this.closest(".CartItems").find(".amount").text();                $this.closest('.CartList').find('.dishcount').text(parseInt(cpnum)-parseInt(v));                set_number(id,v,1,$this);            }        });        function set_number(id,num,flag,$this){            var url="{:U('Cart/modifyCart')}";            var url1="{:U('Cart/getOneCount')}";            $.get(url,"id="+id+"&count="+num+"&flag="+flag).success(function(){                $.get(url1,"id="+id).success(function(data){                    if(flag==1){                        $this.next().text(data);                    }else if(flag==0){                        $this.prev().text(data);                    }                    if(data==null){                        var canming=$("#canming_"+id);                        var parents=canming.closest('.CartList');                        canming.remove();                        if(parents.find('.CartItems').length==0){                            parents.remove();                        }                    }                    set_money();                });            });        }        //清空篮子        $(".remove").click(function(){            clear_cart();        });        function clear_cart(){            var url="{:U('Cart/removeAll')}";            $.get(url).success(function(){                $(".CartList").remove();                cart_info.html('总共：0份&nbsp;');                bill.text(0);                $("div.catr-wrap").text('是空的哟').addClass('cart-default');                //show_empty();                //reset_basket();            });        }        //下单        cart_btn.click(function(){            var $this=$(this);            if(!$this.hasClass('nosubmit') && is_must()){                if(islogin!='0'){                    ztools.maskshow();                    $("#qjBox").show();                    $('#qd').click(function(){                        var sum =$('#quantity').text();                        var yj = $('#yj').text();                        var url='{:U("Cart/settlement","",false)}';                        location.href=url+'/canju_num/'+sum+'/canju_yj/'+yj;                    });                }else{                    location.href='{:U("User/User/login","",false)}';                }            }else{                var tips= $('div.tips-drop');                tips.show();                setTimeout(function(){tips.hide()},3000)                //location.href='{:U("Cart/settlement")}';            }        });        <!--购物车特效-->        function shop_fly(event){            var offset = $('.CartPrice').offset();            var wscrolltop=$(window).scrollTop();            var flyer = $('<div style="display:block; position: fixed; z-index: 9999;color:#fff;text-align:center;font-size:0.5em; width: 24px;height: 24px;line-height:24px;background:red;border-radius: 24px;" ></div>');            flyer.fly({                start: {                    left: event.clientX,                    top: event.clientY                },                end: {                    left: offset.left+20,                    top: offset.top-wscrolltop ,                    width: 20,                    height: 20                },                onEnd: function () {                    this.destory()                }            })        }    </script></block>