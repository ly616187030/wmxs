<extend name="Public/base"/><block name="style">	<style>		img{width:220px;height:170px;}        .red-star:before{            content:"*";            color:red;            font-weight: bold;            font-size:1.2em;            padding-right: 5px;        }        .main-title{            margin-bottom: 20px;        }	</style></block><block name="body">    <div class="main-title cf">        <h3 class="m-b col-sm-8">编辑菜品 <notempty name="storename">/<span style="font-size: 0.6em;color:green;">{$storename}</span></notempty></h3>    </div>	    <form action="{:U('edit')}" method="post" class="form-horizontal" enctype="multipart/form-data">            <div class="col-sm-2">                <div class="form-group">                    <div class="col-sm-12">                        <div  id="_upload_box" class="wu-example">                            <!--用来存放文件信息-->                            <div id="_upload_list" class="uploader-list img-box">                                <notempty name="data.big_img">                                    <div id="_upload_preview" class="file-item thumbnail">                                        <i class="fa fa-times-circle remove-picture"></i>                                        <img src="{$data.big_img|get_new_cover='path'}" data-id="">                                    </div>                                    <else />                                    <div id="_upload_preview" class=" file-item thumbnail hidden">                                        <i class="fa fa-times-circle remove-picture"></i>                                        <img>                                    </div>                                </notempty>                            </div>                            <div class="btns col-xs-12">                                <input type="hidden" id="_upload_input" name="big_img" value="{$data.big_img}">                                <div id="_upload">上传图片</div>                                <button id="ctlBtn" class="btn btn-default hidden">开始上传</button>                            </div>                        </div>                    </div>                    <label style="padding-top:7px;font-weight:normal;">尺寸不小于400×400或<a href="###">从图库中选取</a></label>                    <script type="text/javascript" src="__CUI__/js/cui.extend.min.js"></script>                    <script type="text/javascript">                        $(function(){                            var uploader = WebUploader.create({                                auto: true,                                                                    // 选完文件后，是否自动上传                                duplicate: true,                                                               // 同一文件是否可以重复上传                                swf: '__CUI__/swf/uploader.swf',                                               // swf文件路径                                server: '{:U("Admin/Upload/Upload", array("dir" => "image"))}',    // 文件接收服务端                                pick: '#_upload',                                   							// 选择文件的按钮                                resize: false,                                                                 // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！                                //fileNumLimit: 1,                                                             // 验证文件总数量, 超出则不允许加入队列                                fileSingleSizeLimit:<php> echo C('UPLOAD_FILE_SIZE') ? : 2; </php>*1024*1024,  // 验证单个文件大小是否超出限制, 超出则不允许加入队列                            // 文件过滤                            accept: {                                title: 'Images',                                        extensions: 'gif,jpg,jpeg,bmp,png',                                        mimeTypes: 'image/*'                            }                        });                        // 文件上传过程中创建进度条实时显示。                        uploader.on( 'uploadProgress', function( file, percentage ) {                            $( '#_upload_preview').removeClass('hidden');                            var $li = $( '#_upload_preview'),                                    $percent = $li.find('.progress .progress-bar');                            // 避免重复创建                            if ( !$percent.length ) {                                $percent = $('<div class="progress"><div class="progress-bar"></div></div>')                                        .appendTo( $li )                                        .find('.progress-bar');                            }                            $percent.css( 'width', percentage * 100 + '%' );                        });                        // 完成上传完了，成功或者失败，先删除进度条。                        uploader.on( 'uploadComplete', function( file ) {                            $( '#_upload_preview' ).find('.progress').remove();                        });                        // 文件上传成功，给item添加成功class, 用样式标记上传成功。                        uploader.on( 'uploadSuccess', function( file , response) {                            $( '#_upload_preview' ).addClass('upload-state-done');                            if(eval('response').status == 0){                                $.alertMessager(response.info);                            } else {                                $( '#_upload_input' ).attr('value', response.id);                                $( '#_upload_preview img').attr('src', response.url);                                $( '#_upload_preview img').attr('data-id', response.id);                            }                        });                        // 文件上传失败，显示上传出错。                        uploader.on( 'uploadError', function( file ) {                            $.alertMessager('error');                            var $li = $( '_upload_preview'),                                    $error = $li.find('div.error');                            // 避免重复创建                            if ( !$error.length ) {                                $error = $('<div class="error"></div>').appendTo( $li );                            }                            $error.text('上传失败');                        });                        // 删除图片                        $(document).on('click', '#_upload_list .remove-picture', function() {                            $( '#_upload_input' ).val('') //删除后覆盖原input的值为空                            $( '#_upload_preview').addClass('hidden');                        });                        });                    </script>                </div>            </div>            <div class="col-sm-10">                <input type="hidden" name="store_id" value="{$list.store_id}" />                <input type="hidden" name="cm_id" value="{$data.cm_id}">                <div class="form-group">                    <label class="col-sm-2 control-label red-star">菜品名称</label>                    <div class="col-sm-3">                        <input type="text" class="form-control" name="cm_name" value="{$data.cm_name|default=''}">                    </div>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label">菜品名称拼音简写</label>                    <div class="col-sm-3">                        <input type="text" class="form-control" value="{$data.cm_name_py|default=''}" name="cm_name_py"                               placeholder="如：ABC">                    </div>                    <label style="font-weight:normal;">                        <button type="button" class="btn btn-success" id="autopy">自动生成</button>                    </label>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label red-star">菜品分类</label>                    <div class="col-sm-3">                        <select class="form-control" name="canping_id">                            <volist name="clist" id="vo">                                <option value="{$vo.canpin_id}" <eq name="vo.canpin_id" value="$data.canping_id">selected="selected"</eq>>{$vo.canpin_name}</option>                            </volist>                        </select>                    </div>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label">所属档口</label>                    <div class="col-sm-3">                        <select class="form-control" name="dangkou_id">                            <option value="" style="display: none;">请选择所属档口</option>                            <volist name="dangkou" id="vo">                                <option value="{$vo.id}" <eq name="vo.id" value="$data.dangkou_id">selected="selected"</eq>>{$vo.name}</option>                            </volist>                        </select>                    </div>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label red-star">价格</label>                    <div class="col-sm-2">                        <input type="text" class="form-control" name="now_price" value="{$data.now_price|default=''}">                    </div>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label">折扣</label>                    <div class="col-sm-2">                        <input type="text" class="form-control" value="{$data.discount|default='100'}" name="discount" placeholder="8折80">                    </div>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label">库存</label>                    <div class="col-sm-2">                        <input type="text" class="form-control" value="{$data.storage_number|default='999999'}" name="storage_number" placeholder="必填">                    </div>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label">起订数</label>                    <div class="col-sm-2">                        <input type="text" class="form-control"  name="min_number" value="{$data.min_number}">                    </div>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label">餐盒价格</label>                    <div class="col-sm-2">                        <input type="text" class="form-control" value="{$data.food_box_price}"  name="food_box_price" placeholder="2.0,1.5">                    </div>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label">餐盒数</label>                    <div class="col-sm-2">                        <input type="text" class="form-control" name="food_box_number" value="{$data.food_box_number}">                    </div>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label">菜品单位</label>                    <div class="col-sm-2">                        <input type="text" class="form-control" name="danwei" value="{$data.danwei|default=''}">                    </div>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label">可售时间</label>                    <div class="col-sm-3">                        <select class="form-control" id="saleTime" name="saletime_type">                            <option value="1" <eq name="data.saletime_type" value="1">selected</eq> >同接单时间</option>                            <option value="2" <eq name="data.saletime_type" value="2">selected</eq> >自定义时间</option>                        </select>                    </div>                </div>                <?php if($data['saletime_type'] == 1):?>                <div class="form-group" id="my_define" style="display: none;">                    <label class="col-sm-2 control-label">&nbsp;</label>                    <div class="col-sm-10 clearfix">                        <label class="col-sm-2 control-label">可售星期：</label>                        <div class="col-sm-10 m-b clearfix">                            <label class="checkbox-inline">                                <input type="checkbox"  class="check-all" id="inlineCheckbox10" value="option1">全选                            </label>                            <label class="checkbox-inline">                                <input type="checkbox" name="week[]" class="ids" id="inlineCheckbox11" value="1">星期一                            </label>                            <label class="checkbox-inline">                                <input type="checkbox"  class="ids" name="week[]"  id="inlineCheckbox12" value="2">星期二                            </label>                            <label class="checkbox-inline">                                <input type="checkbox" class="ids" name="week[]"  id="inlineCheckbox13" value="3">星期三                            </label>                            <label class="checkbox-inline">                                <input type="checkbox"  class="ids" name="week[]" id="inlineCheckbox14" value="4">星期四                            </label>                            <label class="checkbox-inline">                                <input type="checkbox" class="ids"  name="week[]" id="inlineCheckbox15" value="5">星期五                            </label>                            <label class="checkbox-inline">                                <input type="checkbox"  class="ids" name="week[]" id="inlineCheckbox16" value="6">星期六                            </label>                            <label class="checkbox-inline">                                <input type="checkbox" class="ids"  name="week[]" id="inlineCheckbox17" value="7">星期日                            </label>                        </div>                    </div>                    <div class="col-sm-4 col-sm-offset-3 m-b sale-time">                        <input type="text" class="form-control"  style="width:60px;float:left;" name="sale_time[1][]"  placeholder="14"/>                        <span style="display: inline-block;font-size: 1.5em;float: left">:</span>                        <input type="text" class="form-control" style="width:60px;float:left;" name="sale_time[1][]"  placeholder="20"/>                        <span style="display: inline-block;font-size: 1.5em;float: left">-</span>                        <input type="text" class="form-control"  style="width:60px;float:left;" name="sale_time[1][]"  placeholder="21"/>                        <span style="display: inline-block;font-size: 1.5em;float: left">:</span>                        <input type="text" class="form-control" style="width:60px;float:left;" name="sale_time[1][]"  placeholder="30"/>                    </div>                    <div class="col-sm-4 col-sm-offset-3 m-b">                        <a href="javascript:void(0)" id="add_time"><i class="fa fa-plus"></i>时间段</a>                    </div>                </div>                <?php endif;?>                <php>if($data['saletime_type'] == 2):$week = explode(',',$data['week'])</php>                <div class="form-group" id="my_define">                    <label class="col-sm-2 control-label">&nbsp;</label>                    <div class="col-sm-10 clearfix">                        <label class="col-sm-2 control-label">可售星期：</label>                        <div class="col-sm-10 m-b clearfix">                            <label class="checkbox-inline">                                <input type="checkbox"  class="check-all" <php>if(count($week) == 7):</php>checked<php>endif;</php> id="inlineCheckbox10" value="option1">全选                            </label>                            <label class="checkbox-inline">                                <input type="checkbox" name="week[]" <php>if(in_array(1,$week)):</php>checked<php>endif;</php> class="ids" id="inlineCheckbox11" value="1">星期一                            </label>                            <label class="checkbox-inline">                                <input type="checkbox"  class="ids" name="week[]" <php>if(in_array(2,$week)):</php>checked<php>endif;</php>   id="inlineCheckbox12" value="2">星期二                            </label>                            <label class="checkbox-inline">                                <input type="checkbox" class="ids" name="week[]" <php>if(in_array(3,$week)):</php>checked<php>endif;</php>   id="inlineCheckbox13" value="3">星期三                            </label>                            <label class="checkbox-inline">                                <input type="checkbox"  class="ids" name="week[]" <php>if(in_array(4,$week)):</php>checked<php>endif;</php>  id="inlineCheckbox14" value="4">星期四                            </label>                            <label class="checkbox-inline">                                <input type="checkbox" class="ids"  name="week[]" <php>if(in_array(5,$week)):</php>checked<php>endif;</php>  id="inlineCheckbox15" value="5">星期五                            </label>                            <label class="checkbox-inline">                                <input type="checkbox"  class="ids" name="week[]" <php>if(in_array(6,$week)):</php>checked<php>endif;</php>  id="inlineCheckbox16" value="6">星期六                            </label>                            <label class="checkbox-inline">                                <input type="checkbox" class="ids"  name="week[]" <php>if(in_array(7,$week)):</php>checked<php>endif;</php>  id="inlineCheckbox17" value="7">星期日                            </label>                        </div>                    </div>                    <?php if(!empty($data['sale_time'])): $str = explode('|',$data['sale_time']);?>                    <?php foreach($str as $key=>$val):?>                    <div class="col-sm-4 col-sm-offset-3 m-b sale-time">                        <input type="text" class="form-control"  style="width:60px;float:left;" name="sale_time[<?php echo $key?>][]" value="<?php echo $val[0].$val[1]?>"  placeholder="14"/>                        <span style="display: inline-block;font-size: 1.5em;float: left">:</span>                        <input type="text" class="form-control" style="width:60px;float:left;" name="sale_time[<?php echo $key?>][]"  value="<?php echo $val[2].$val[3]?>"  placeholder="20"/>                        <span style="display: inline-block;font-size: 1.5em;float: left">-</span>                        <input type="text" class="form-control"  style="width:60px;float:left;" name="sale_time[<?php echo $key?>][]"  value="<?php echo $val[4].$val[5]?>"  placeholder="21"/>                        <span style="display: inline-block;font-size: 1.5em;float: left">:</span>                        <input type="text" class="form-control" style="width:60px;float:left;" name="sale_time[<?php echo $key?>][]"  value="<?php echo $val[6].$val[7]?>"  placeholder="30"/>                    </div>                    <?php endforeach;?>                    <?php endif;?>                    <div class="col-sm-4 col-sm-offset-3 m-b">                        <a href="javascript:void(0)" id="add_time"><i class="fa fa-plus"></i>时间段</a>                    </div>                </div>                <php>endif;</php>                <div class="form-group">                    <label class="col-sm-2 control-label">排序</label>                    <div class="col-sm-2">                        <input type="text" class="form-control" name="sort_order" value="{$data.sort_order}">                    </div>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label">菜名描述</label>                    <div class="col-sm-3">                        <textarea class="form-control" rows="3" name="cm_desc" maxlength="120" placeholder="最多只能输入120个字">{$data.cm_desc}</textarea>                    </div>                </div>                <div class="form-group">                    <label class="col-sm-2 control-label">&nbsp;</label>                    <div class="col-sm-4">                        <button class="btn submit-btn ajax-post" id="submit" type="submit" target-form="form-horizontal">确 定</button>                        <button class="btn btn-return " onclick="history.back(-1);return false;">返 回</button>                    </div>                </div>            </div></block><block name="script">    <script type="text/javascript">        //可售时间        $('#saleTime').change(function(){            var $this = $(this);            var val = $this.val();            var my = $('#my_define');            if(val == 1)                my.hide();            if(val == 2)                my.show();            $('.sale-time').each(function(i){                if(i!=0)                    $(this).remove();            });        });        //新增时间段        $('#add_time').click(function(){            var $this = $(this);            var j = $('.sale-time').length;            var c = $this.parent().prev().clone();            var inputs = c.find('input');            for(var i= 0,ln = inputs.length;i<ln;i++){                inputs.eq(i).attr('name','sale_time['+(j)+'][]');            }            $this.parent().prev().after(c);        });        //全选        $(".check-all").click(function(){            $(".ids").prop("checked", this.checked);        });        $(".ids").click(function(){            var option = $(".ids");            option.each(function(i){                if(!this.checked){                    $(".check-all").prop("checked", false);                    return false;                }else{                    $(".check-all").prop("checked", true);                }            });        });        //自动生成拼音        $("#autopy").click(function () {            var $this = $(this);            var key = $("input[name='cm_name']").val();            if ($.trim(key) != '') {                $.get("{:U('Store/cu2py')}", "keys=" + key).success(function (data) {                    $this.closest("div").find("input").val(data);                });            } else {                alert("请输入店铺名称");            }        });    </script></block>